if (self.CavalryLogger) { CavalryLogger.start_js_script(document.currentScript); }/*FB_PKG_DELIM*/

__d("LSSerializeBackupPayloadIndirection.bs",["bs_curry","cr:280","cr:740","unrecoverableViolation"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d,e,f){if(b("cr:740")==null)if(b("cr:280")==null)return b("unrecoverableViolation")("LSSerializeBackupPayloadIndirection.res: messenger_armadillo_web:enable_armadillo OR messenger_armadillo_web:enable_encrypted_backups_shadow_test is not defined","labyrinth_web");else return b("bs_curry")._5(b("cr:280").call,a,c,d,e,f).then(function(a){return a});else return b("bs_curry")._5(b("cr:740").call,a,c,d,e,f).then(function(a){return a})}f.$LSSerializeBackupPayloadConditional$requireCond=b("cr:280");f.$LSSerializeBackupPayloadConditional$requireCond$1=b("cr:740");f.call=a}),null);
__d("LSDeleteBackupOnClient",["LSAppendDataTraceAddon","LSFlushDataTrace.bs"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(d){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure]Beginning execution."),a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,1423],[0,2],f,f):c.resolve()},function(b){return d[0]=!1,d[0]?d[1]=!0:d[1]=!1,d[1]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0,c.i64.neq(a[0],f)?c.fe(c.db.table(168).fetch([[[a[0]]]]),function(a){return a["delete"]()}):c.fe(c.db.table(168).fetch(),function(a){return a["delete"]()})},function(b){return a[2]?c.fe(c.db.table(172).fetch([[[[0,1]]]]),function(a){var b=a.update;a.item;return b({backupId:f})}):c.resolve()},function(e){return a[5]?c.seq([function(e){return a[5]?c.seq([function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,84],[0,2],f,f):c.resolve()},function(a){return d[4]=!1,d[4]?d[5]=!0:d[5]=!1,d[5]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):a[3]!==f?c.seq([function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,85],[0,2],"The flow did not succeed",f):c.resolve()},function(a){return d[4]=!1,d[4]?d[5]=!0:d[5]=!1,d[5]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(d){return a[3]!==f?c.nop(b("LSFlushDataTrace.bs"),a[3]):c.resolve()},function(a){return d[2]=!1,d[2]?d[3]=!0:d[3]=!1,d[3]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):a[4]!==f?c.seq([function(e){return d[4]=["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure]","",a[4]].join(""),function(a){c.logger(a).mustfix(a)}(d[4]),a[3]!==f?c.seq([function(e){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,85],[0,2],d[4],f):c.resolve()},function(a){return d[5]=!1,d[5]?d[6]=!0:d[6]=!1,d[6]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(d){return a[3]!==f?c.nop(b("LSFlushDataTrace.bs"),a[3]):c.resolve()},function(a){return d[2]=!1,d[2]?d[3]=!0:d[3]=!1,d[3]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.seq([function(e){return a[3]!==f?c.seq([function(d){return a[3]!==f?c.sp(b("LSAppendDataTraceAddon"),a[3],[0,85],[0,2],["[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure]","",""].join(""),f):c.resolve()},function(a){return d[4]=!1,d[4]?d[5]=!0:d[5]=!1,d[5]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(d){return a[3]!==f?c.nop(b("LSFlushDataTrace.bs"),a[3]):c.resolve()},function(a){return d[2]=!1,d[2]?d[3]=!0:d[3]=!1,d[3]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}])},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsDeleteBackupOnClientStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSSyncEpochs",["LSAppendDataTraceAddon","LSCreateDataTraceID.bs","LSDeleteBackupOnClient","LSFlushDataTrace.bs","LSIssueNewTask"],(function(a,b,c,d,e,f){function g(){var a=babelHelpers.taggedTemplateLiteralLoose(["0"]);g=function(){return a};return a}function a(){var a=arguments,c=a[a.length-1],d=c.n,e=[],f=[],h;return c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]Beginning execution."),c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])&&c.i64.eq(a.backupTenancy,[0,2])}),0,c.i64.to_float([0,1])).next().then(function(a,b){b=a.done;a=a.value;return b?e[0]=!1:(a.item,e[0]=!0)})},function(a){return e[0]?e[2]=c.i64.or_([0,78],[0,128]):e[2]=[0,78],c.nop(b("LSCreateDataTraceID.bs")).then(function(a){return a=a,e[3]=a[0],a})},function(a){return e[4]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils]",e[4],"EncryptedBackups Trace ID",e[4],c.i64.to_string(e[2])].join("")),c.db.table(153).add({traceId:e[3],initTimestampMs:c.i64.of_float(Date.now()),traceType:e[2],shouldFlush:!1,contextThree:"synch_epochs"})},function(a){return e[5]=!1,e[5]?e[6]=!0:e[6]=!1,e[6]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0,e[3]!==h?c.sp(b("LSAppendDataTraceAddon"),e[3],[0,1436],[0,2],h,h):c.resolve()},function(a){return e[7]=!1,e[7]?e[8]=!0:e[8]=!1,e[8]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0,c.ftr(c.db.table(2).fetch(),function(a){return a.context===c.i64.to_string([0,50013])}).next().then(function(a,b){b=a.done;a=a.value;return b?e[9]=!1:(a.item,e[9]=!0)})},function(a){return e[9]?(e[11]="Another sync job is already in progress. Terminating this.",e[11]!==h?c.seq([function(a){return e[14]=["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]","",e[11]].join(""),function(a){c.logger(a).mustfix(a)}(e[14]),e[3]!==h?c.seq([function(a){return e[3]!==h?c.sp(b("LSAppendDataTraceAddon"),e[3],[0,85],[0,2],e[14],h):c.resolve()},function(a){return e[15]=!1,e[15]?e[16]=!0:e[16]=!1,e[16]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(a){return e[3]!==h?c.nop(b("LSFlushDataTrace.bs"),e[3]):c.resolve()},function(a){return e[12]=!1,e[12]?e[13]=!0:e[13]=!1,e[13]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.seq([function(a){return e[3]!==h?c.seq([function(a){return e[3]!==h?c.sp(b("LSAppendDataTraceAddon"),e[3],[0,85],[0,2],["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]","",""].join(""),h):c.resolve()},function(a){return e[14]=!1,e[14]?e[15]=!0:e[15]=!1,e[15]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(a){return e[3]!==h?c.nop(b("LSFlushDataTrace.bs"),e[3]):c.resolve()},function(a){return e[12]=!1,e[12]?e[13]=!0:e[13]=!1,e[13]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}])):c.seq([function(a){return c.ct(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])})).then(function(a){return e[11]=a})},function(a){return c.i64.eq(e[11],[0,1])?c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])}).next().then(function(a,f){var i=a.done;a=a.value;return i?0:(f=a.item,e[13]=f.backupId,e[12]=f.deviceId,c.i64.neq(e[12],h)?c.seq([function(a){return c.ct(c.db.table(169).fetch()).then(function(a){return e[14]=a})},function(a){return c.i64.neq(e[14],d(g()))?e[15]=!0:e[15]=!1,e[15]?(e[16]=new c.Map(),e[16].set("backup_id",e[13]),e[16].set("device_id",e[12]),e[16].set("trace_id",e[3]),e[17]=c.toJSON(e[16]),c.sp(b("LSIssueNewTask"),"messenger_encrypted_backups",[0,50013],e[17],h,h,[0,0],[0,0],h,h,[0,0])):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]epochs table is null/empty. Cleaning backup on client"),e[3]!==h?c.seq([function(a){return e[3]!==h?c.sp(b("LSAppendDataTraceAddon"),e[3],[0,85],[0,2],"[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]epochs table is null/empty. Cleaning backup on client",h):c.resolve()},function(a){return e[16]=!1,e[16]?e[17]=!0:e[17]=!1,e[17]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(a){return c.sp(b("LSDeleteBackupOnClient"),e[13],"synch_epochs",!0,e[3],"epochs table is null/empty. Cleaning backup on client",!1)}])}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]device_id is null. Cleaning backup on client"),e[3]!==h?c.seq([function(a){return e[3]!==h?c.sp(b("LSAppendDataTraceAddon"),e[3],[0,85],[0,2],"[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]device_id is null. Cleaning backup on client",h):c.resolve()},function(a){return e[14]=!1,e[14]?e[15]=!0:e[15]=!1,e[15]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(a){return c.sp(b("LSDeleteBackupOnClient"),e[13],"synch_epochs",!0,e[3],"device_id is null. Cleaning backup on client",!1)}]))}):c.seq([function(a){return e[16]="Exactly 1 entry is expected in client_state_table",e[16]!==h?c.seq([function(a){return e[19]=["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]","",e[16]].join(""),function(a){c.logger(a).mustfix(a)}(e[19]),e[3]!==h?c.seq([function(a){return e[3]!==h?c.sp(b("LSAppendDataTraceAddon"),e[3],[0,85],[0,2],e[19],h):c.resolve()},function(a){return e[20]=!1,e[20]?e[21]=!0:e[21]=!1,e[21]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(a){return e[3]!==h?c.nop(b("LSFlushDataTrace.bs"),e[3]):c.resolve()},function(a){return e[17]=!1,e[17]?e[18]=!0:e[18]=!1,e[18]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.seq([function(a){return e[3]!==h?c.seq([function(a){return e[3]!==h?c.sp(b("LSAppendDataTraceAddon"),e[3],[0,85],[0,2],["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]","",""].join(""),h):c.resolve()},function(a){return e[19]=!1,e[19]?e[20]=!0:e[20]=!1,e[20]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(a){return e[3]!==h?c.nop(b("LSFlushDataTrace.bs"),e[3]):c.resolve()},function(a){return e[17]=!1,e[17]?e[18]=!0:e[18]=!1,e[18]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}])},function(a){return e[14]="Exactly 1 entry is expected in client_state_table. Found = ",c.ct(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])})).then(function(a){return e[12]=a})},function(a){return e[15]=c.i64.to_string(e[12]),e[13]="",function(a){c.logger(a).mustfix(a)}(["[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]",e[13],e[14],e[13],e[15]].join(""))}])}])},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsSyncEpochsStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(f)}])}e.exports=a}),null);
__d("LSTaskSerializerMuteThreadV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(f){return b.seq([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,f){var g=d.done;d=d.value;return g?(c[3]=b.createArray(),c[4]=(c[3].push("TaskSerializerMuteThreadV2: Task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),g=[e,e],c[0]=g[0],c[1]=g[1],g):(f=d.item,b.seq([function(a){return c[6]=f.threadKey,b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,f){var a=d.done;d=d.value;return a?(c[7]=b.createArray(),c[8]=(c[7].push("TaskSerializerMuteThreadV2: Thread not found"),c[7]),c[9]=(c[7].push(c[6]),c[7]),c[10]=b.toJSON(c[7]),function(a){b.logger(a).mustfix(a)}(c[10]),a=[e,e],c[3]=a[0],c[4]=a[1],a):(f=d.item,b.seq([function(a){return b.db.table(9).fetch([[[c[6]]]]).next().then(function(d,f){var a=d.done;d=d.value;return a?c[7]=[0,1]:(f=d.item,c[12]=f.syncGroup,b.i64.neq(c[12],e)?c[11]=c[12]:c[11]=[0,1],c[7]=c[11])})},function(a){return c[9]=new b.Map(),c[9].set("thread_key",c[6]),c[9].set("mailbox_type",[0,0]),c[9].set("mute_expire_time_ms",f.muteExpireTimeMs),c[9].set("sync_group",c[7]),c[10]=b.toJSON(c[9]),a=[c[10],[0,144]],c[3]=a[0],c[4]=a[1],a}]))})},function(a){return a=[c[3],c[4]],c[0]=a[0],c[1]=a[1],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSTaskSerializerRemoveThread",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(f){return b.seq([function(d){return b.db.table(32).fetch([[[a[0]]]]).next().then(function(d,f){var g=d.done;d=d.value;return g?(c[3]=b.createArray(),c[4]=(c[3].push("TaskSerializerRemoveThreadV2: Task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),g=[e,e],c[0]=g[0],c[1]=g[1],g):(f=d.item,c[5]=f.removeType,b.i64.neq(c[5],e)?(c[6]=new b.Map(),c[6].set("thread_key",f.threadKey),c[6].set("remove_type",c[5]),c[6].set("sync_group",f.syncGroup==null?[0,1]:f.syncGroup),c[7]=b.toJSON(c[6]),g=[c[7],[0,146]],c[3]=g[0],c[4]=g[1],g):(d=[e,e],c[3]=d[0],c[4]=d[1],d),f=[c[3],c[4]],c[0]=f[0],c[1]=f[1],f)})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSTaskSerializerSendMessageV2",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(f){return b.seq([function(d){return b.db.table(31).fetch([[[a[0]]]]).next().then(function(d,f){var g=d.done;d=d.value;return g?(c[3]=b.createArray(),c[4]=(c[3].push("task ID not found"),c[3]),c[5]=(c[3].push(a[0]),c[3]),c[6]=b.toJSON(c[3]),function(a){b.logger(a).mustfix(a)}(c[6]),g=[e,e],c[0]=g[0],c[1]=g[1],g):(f=d.item,b.seq([function(d){return c[9]=f.offlineThreadingId,c[10]=f.messageId,c[14]=f.threadAttributionSource,c[7]=f.platformRef,c[8]=f.platformToken,c[6]=f.replySourceId,c[11]=f.replySourceType,c[13]=f.sendType,c[12]=f.initiatingSource,b.db.table(12).fetch([[[c[9]]],"optimistic"]).next().then(function(f,h){var d=f.done;f=f.value;return d?(c[15]=b.createArray(),c[16]=(c[15].push("OTID not found"),c[15]),c[17]=(c[15].push(c[9]),c[15]),c[18]=b.toJSON(c[15]),function(a){b.logger(a).mustfix(a)}(c[18]),d=[e,e],c[3]=d[0],c[4]=d[1],d):(h=f.item,b.seq([function(d){return c[21]=h.text,c[19]=h.threadKey,c[22]=h.messageId,c[20]=h.stickerId,c[24]=h.mentionOffsets,c[25]=h.mentionLengths,c[18]=h.mentionIds,c[26]=h.mentionTypes,c[29]=h.replyType,c[27]=h.isForwarded,c[23]=h.forwardScore,c[28]=h.hotEmojiSize,b.db.table(9).fetch([[[c[19]]]]).next().then(function(f,i){var d=f.done;f=f.value;return d?(c[30]=b.createArray(),c[31]=(c[30].push("thread not found"),c[30]),c[32]=(c[30].push(c[19]),c[30]),c[33]=b.toJSON(c[30]),function(a){b.logger(a).mustfix(a)}(c[33]),d=[e,e],c[15]=d[0],c[16]=d[1],d):(i=f.item,b.seq([function(d){return b.db.table(2).fetch([[[a[0]]]]).next().then(function(e,f){var d=e.done;e=e.value;return d?c[30]=!1:(f=e.item,b.seq([function(d){return b.islc(b.db.table(2).fetch([[[f.queueName]],"queueNameTaskId"]),0,b.i64.to_float([0,1])).next().then(function(e,f){var d=e.done;e=e.value;return d?c[34]=!1:(f=e.item,c[34]=b.i64.eq(f.taskId,a[0]))})},function(a){return c[30]=c[34]}]))})},function(a){return b.i64.eq(i.authorityLevel,[0,20])&&b.i64.eq(i.threadType,[0,2])&&c[30]?b.seq([function(a){return c[35]=c[13]==null?[0,1]:c[13],c[34]=new b.Map(),c[34].set("thread_id",c[19]),c[34].set("otid",c[9]),c[34].set("source",c[14]==null?[0,0]:c[14]),c[34].set("send_type",[0,1]),b.i64.eq(c[35],[0,1])?b.resolve(c[34].set("text",c[21])):b.i64.eq(c[35],[0,2])?b.resolve(b.i64.neq(c[20],e)?(c[34].set("sticker_id",c[20]),c[34].set("send_type",c[35])):0):b.i64.eq(c[35],[0,7])?b.seq([function(a){return b.db.table(16).fetch([[[c[19],c[22]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[43]=a[0],c[44]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[43]=a[0],c[44]=a[1],a)})},function(a){return c[43]!==e?b.i64.neq(c[44],e)?(c[34].set("url",c[43]),c[34].set("attribution_app_id",c[44]),c[34].set("send_type",c[35])):0:0}]):b.i64.eq(c[35],[0,3])?b.seq([function(a){return c[34].set("text",c[21]),c[43]=b.createArray(),c[44]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[19],c[22]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[45]=a.offlineAttachmentId,c[46]=(c[43].push(b.i64.from_string(a.attachmentFbid)),c[43]),c[45]!==e?c[46]=(c[44].push(c[45]),c[44]):0})},function(a){return c[34].set("attachment_fbids",c[43]),b.i64.eq(c[35],[0,9])?c[34].set("offline_attachment_ids",c[44]):0,c[34].set("send_type",c[35])}]):b.i64.eq(c[35],[0,9])?b.seq([function(a){return c[34].set("text",c[21]),c[43]=b.createArray(),c[44]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[19],c[22]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[45]=a.offlineAttachmentId,c[46]=(c[43].push(b.i64.from_string(a.attachmentFbid)),c[43]),c[45]!==e?c[46]=(c[44].push(c[45]),c[44]):0})},function(a){return c[34].set("attachment_fbids",c[43]),b.i64.eq(c[35],[0,9])?c[34].set("offline_attachment_ids",c[44]):0,c[34].set("send_type",c[35])}]):b.i64.eq(c[35],[0,10])?b.seq([function(a){return c[34].set("text",c[21]),c[43]=b.createArray(),c[44]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[19],c[22]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[45]=a.offlineAttachmentId,c[46]=(c[43].push(b.i64.from_string(a.attachmentFbid)),c[43]),c[45]!==e?c[46]=(c[44].push(c[45]),c[44]):0})},function(a){return c[34].set("attachment_fbids",c[43]),b.i64.eq(c[35],[0,9])?c[34].set("offline_attachment_ids",c[44]):0,c[34].set("send_type",c[35])}]):b.i64.eq(c[35],[0,4])?b.seq([function(a){return b.db.table(16).fetch([[[c[19],c[22]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[43]=e:(d=b.item,c[43]=d.attachmentFbid)})},function(a){return c[43]!==e?(c[34].set("text",c[21]),c[34].set("forwarded_share_id",c[43]),c[34].set("send_type",c[35])):0}]):b.i64.eq(c[35],[0,5])?b.resolve(c[10]!==e?(c[34].set("forwarded_msg_id",c[10]),c[34].set("send_type",c[35]),b.i64.neq(c[23],e)?c[34].set("forward_score",c[23]):0):0):b.i64.eq(c[35],[0,6])?b.seq([function(a){return b.db.table(16).fetch([[[c[19],c[22]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[43]=a[0],c[44]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[43]=a[0],c[44]=a[1],a)})},function(a){return c[43]!==e?(c[34].set("url",c[43]),c[34].set("text",c[21]),c[34].set("send_type",c[35])):0}]):b.resolve(0)},function(a){return c[39]=c[6]===""?e:c[6],c[39]!==e?b.i64.neq(c[11],e)?(c[43]=new b.Map(),c[43].set("reply_source_id",c[39]),c[43].set("reply_source_type",c[11]),c[43].set("reply_type",c[29]==null?[0,0]:c[29]),c[34].set("reply_metadata",c[43])):0:0,c[40]=c[18]===""?e:c[18],c[40]!==e?(c[43]=c[24]===""?e:c[24],c[43]!==e?(c[44]=c[25]===""?e:c[25],c[44]!==e?(c[45]=new b.Map(),c[45].set("mention_ids",c[40]),c[45].set("mention_offsets",c[43]),c[45].set("mention_lengths",c[44]),c[45].set("mention_types",c[26]===""?e:c[26]),c[34].set("mention_data",c[45])):0):0):0,c[27]!==e?c[34].set("is_forwarded",c[27]):0,c[41]=c[7]===""?e:c[7],c[41]!==e?c[34].set("platform_ref",c[41]):0,c[42]=c[8]===""?e:c[8],c[42]!==e?c[34].set("platform_token",c[42]):0,[[0,1],[0,2]].some(function(a){return b.i64.eq(c[35],a)})?b.i64.neq(c[28],e)?c[34].set("hot_emoji_size",c[28]):0:0,b.i64.neq(c[12],e)?c[34].set("initiating_source",c[12]):0,c[36]=b.createArray(),b.fe(b.db.table(14).fetch([[[c[19]]]]),function(a){a=a.item;return c[43]=(c[36].push(a.contactId),c[36])})},function(a){return c[37]=new b.Map(),c[37].set("participants",c[36]),c[37].set("send_payload",c[34]),b.fe(b.db.table(9).fetch([[[i.threadKey]]]),function(a){var b=a.update;a.item;return b({otidOfFirstMessage:h.offlineThreadingId})})},function(a){return c[38]=b.toJSON(c[37]),a=[c[38],[0,130]],c[32]=a[0],c[33]=a[1],a}]):b.seq([function(a){return c[35]=c[13]==null?[0,1]:c[13],c[34]=new b.Map(),c[34].set("thread_id",c[19]),c[34].set("otid",c[9]),c[34].set("source",c[14]==null?[0,0]:c[14]),c[34].set("send_type",[0,1]),b.i64.eq(c[35],[0,1])?b.resolve(c[34].set("text",c[21])):b.i64.eq(c[35],[0,2])?b.resolve(b.i64.neq(c[20],e)?(c[34].set("sticker_id",c[20]),c[34].set("send_type",c[35])):0):b.i64.eq(c[35],[0,7])?b.seq([function(a){return b.db.table(16).fetch([[[c[19],c[22]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[41]=a[0],c[42]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[41]=a[0],c[42]=a[1],a)})},function(a){return c[41]!==e?b.i64.neq(c[42],e)?(c[34].set("url",c[41]),c[34].set("attribution_app_id",c[42]),c[34].set("send_type",c[35])):0:0}]):b.i64.eq(c[35],[0,3])?b.seq([function(a){return c[34].set("text",c[21]),c[41]=b.createArray(),c[42]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[19],c[22]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[43]=a.offlineAttachmentId,c[44]=(c[41].push(b.i64.from_string(a.attachmentFbid)),c[41]),c[43]!==e?c[44]=(c[42].push(c[43]),c[42]):0})},function(a){return c[34].set("attachment_fbids",c[41]),b.i64.eq(c[35],[0,9])?c[34].set("offline_attachment_ids",c[42]):0,c[34].set("send_type",c[35])}]):b.i64.eq(c[35],[0,9])?b.seq([function(a){return c[34].set("text",c[21]),c[41]=b.createArray(),c[42]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[19],c[22]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[43]=a.offlineAttachmentId,c[44]=(c[41].push(b.i64.from_string(a.attachmentFbid)),c[41]),c[43]!==e?c[44]=(c[42].push(c[43]),c[42]):0})},function(a){return c[34].set("attachment_fbids",c[41]),b.i64.eq(c[35],[0,9])?c[34].set("offline_attachment_ids",c[42]):0,c[34].set("send_type",c[35])}]):b.i64.eq(c[35],[0,10])?b.seq([function(a){return c[34].set("text",c[21]),c[41]=b.createArray(),c[42]=b.createArray(),b.fe(b.sb(b.db.table(16).fetch([[[c[19],c[22]]]]),[["attachmentIndex","ASC"]]),function(a){a=a.item;return c[43]=a.offlineAttachmentId,c[44]=(c[41].push(b.i64.from_string(a.attachmentFbid)),c[41]),c[43]!==e?c[44]=(c[42].push(c[43]),c[42]):0})},function(a){return c[34].set("attachment_fbids",c[41]),b.i64.eq(c[35],[0,9])?c[34].set("offline_attachment_ids",c[42]):0,c[34].set("send_type",c[35])}]):b.i64.eq(c[35],[0,4])?b.seq([function(a){return b.db.table(16).fetch([[[c[19],c[22]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?c[41]=e:(d=b.item,c[41]=d.attachmentFbid)})},function(a){return c[41]!==e?(c[34].set("text",c[21]),c[34].set("forwarded_share_id",c[41]),c[34].set("send_type",c[35])):0}]):b.i64.eq(c[35],[0,5])?b.resolve(c[10]!==e?(c[34].set("forwarded_msg_id",c[10]),c[34].set("send_type",c[35]),b.i64.neq(c[23],e)?c[34].set("forward_score",c[23]):0):0):b.i64.eq(c[35],[0,6])?b.seq([function(a){return b.db.table(16).fetch([[[c[19],c[22]]]]).next().then(function(b,d){var a=b.done;b=b.value;return a?(a=[e,e],c[41]=a[0],c[42]=a[1],a):(d=b.item,a=[d.filename,d.attributionAppId],c[41]=a[0],c[42]=a[1],a)})},function(a){return c[41]!==e?(c[34].set("url",c[41]),c[34].set("text",c[21]),c[34].set("send_type",c[35])):0}]):b.resolve(0)},function(a){return c[37]=c[6]===""?e:c[6],c[37]!==e?b.i64.neq(c[11],e)?(c[41]=new b.Map(),c[41].set("reply_source_id",c[37]),c[41].set("reply_source_type",c[11]),c[41].set("reply_type",c[29]==null?[0,0]:c[29]),c[34].set("reply_metadata",c[41])):0:0,c[38]=c[18]===""?e:c[18],c[38]!==e?(c[41]=c[24]===""?e:c[24],c[41]!==e?(c[42]=c[25]===""?e:c[25],c[42]!==e?(c[43]=new b.Map(),c[43].set("mention_ids",c[38]),c[43].set("mention_offsets",c[41]),c[43].set("mention_lengths",c[42]),c[43].set("mention_types",c[26]===""?e:c[26]),c[34].set("mention_data",c[43])):0):0):0,c[27]!==e?c[34].set("is_forwarded",c[27]):0,c[39]=c[7]===""?e:c[7],c[39]!==e?c[34].set("platform_ref",c[39]):0,c[40]=c[8]===""?e:c[8],c[40]!==e?c[34].set("platform_token",c[40]):0,[[0,1],[0,2]].some(function(a){return b.i64.eq(c[35],a)})?b.i64.neq(c[28],e)?c[34].set("hot_emoji_size",c[28]):0:0,b.i64.neq(c[12],e)?c[34].set("initiating_source",c[12]):0,c[36]=b.toJSON(c[34]),a=[c[36],[0,46]],c[32]=a[0],c[33]=a[1],a}])},function(a){return a=[c[32],c[33]],c[15]=a[0],c[16]=a[1],a}]))})},function(a){return a=[c[15],c[16]],c[3]=a[0],c[4]=a[1],a}]))})},function(a){return a=[c[3],c[4]],c[0]=a[0],c[1]=a[1],a}]))})},function(a){return a=[c[0],c[1]],d[0]=a[0],d[1]=a[1],a}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSBeginHandlingPendingTasksForQueue",["LSAppendDataTraceAddon","LSFlushDataTrace.bs","LSSerializeBackupPayloadIndirection.bs","LSSyncEpochs","LSTaskSerializerMuteThreadV2","LSTaskSerializerRemoveThread","LSTaskSerializerSendMessageV2","gkx","qex"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(b){return c.ftr(c.db.table(3).fetch([[[a[0]]]]),function(b){return c.i64.neq(b.epochId,f)&&b.taskQueueName===a[0]}).next().then(function(a,b){b=a.done;a=a.value;return b?d[0]=!1:(a.item,d[0]=!0)})},function(e){return d[2]=new c.Map(),d[2].set("queue_name",a[0]),d[2].set("next_sync_ms",f),d[2].set("work_item_type",[0,4]),d[2].set("network_payload",f),d[2].set("http_url_override",f),d[2].set("skip_realtime_gateway",!1),d[3]=d[2],d[0]?c.resolve():c.seq([function(b){return c.islc(c.db.table(2).fetch([[[a[0]]],"queueNameTaskId"]),0,c.i64.to_float([0,1])).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=["",[-1,4294967295],[0,0],[-1,4294967295],f,f],d[4]=c[0],d[5]=c[1],d[6]=c[2],d[7]=c[3],d[8]=c[4],d[9]=c[5],c):(b=a.item,c=[b.queueName,b.minTimeToSyncTimestampMs,b.pluginType,b.failureCount,b.context,b.httpUrlOverride],d[4]=c[0],d[5]=c[1],d[6]=c[2],d[7]=c[3],d[8]=c[4],d[9]=c[5],c)})},function(b){return c.db.table(3).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[11]=[0,0]:(b=a.item,d[11]=b.lastSyncRequestTimestampMs)})},function(e){return d[14]=c.i64.sub(d[5],c.i64.of_float(Date.now())),c.i64.le(d[14],[0,0])?(c.i64.eq(d[7],[0,0])||a[1]?d[15]=[0,0]:(c.i64.gt(d[7],[0,7])?d[17]=c.i64.sub(d[7],[0,7]):d[17]=d[7],d[18]=c.i64.sub(d[17],[0,1]),d[19]=c.i64.mul(c.i64.lsl_([0,1],c.i64.to_int32(c.i64.lt(d[18],[0,7])?d[18]:[0,7])),[0,500]),d[15]=c.i64.lt(d[19],[0,3e4])?d[19]:[0,3e4]),d[16]=c.i64.sub(c.i64.add(d[11],d[15]),c.i64.of_float(Date.now())),d[13]=c.i64.gt(d[16],[0,0])?d[16]:[0,0]):d[13]=d[14],c.i64.neq(d[13],[0,0])?c.resolve((d[15]=new c.Map(),d[15].set("queue_name",a[0]),d[15].set("next_sync_ms",d[13]),d[15].set("work_item_type",[0,3]),d[15].set("network_payload",f),d[15].set("http_url_override",f),d[15].set("skip_realtime_gateway",!1),d[3]=d[15])):c.seq([function(a){return c.i64.neq(d[6],[0,0])||d[8]==="16"||d[8]==="4"?c.resolve((a=[d[4],f,[0,2],f,f,!1],d[15]=a[0],d[16]=a[1],d[17]=a[2],d[18]=a[3],d[19]=a[4],d[20]=a[5],a)):c.seq([function(a){return d[22]=c.createArray(),d[23]=!0,c.islc(c.db.table(2).fetch([[[d[4]]],"queueNameTaskId"]),0,c.i64.to_float([0,1])).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=["",[-1,4294967295],[0,0],[-1,4294967295],f,f],d[24]=c[0],d[25]=c[1],d[26]=c[2],d[27]=c[3],d[28]=c[4],d[29]=c[5],c):(b=a.item,c=[b.queueName,b.minTimeToSyncTimestampMs,b.pluginType,b.failureCount,b.context,b.httpUrlOverride],d[24]=c[0],d[25]=c[1],d[26]=c[2],d[27]=c[3],d[28]=c[4],d[29]=c[5],c)})},function(a){return c.db.table(2).fetch([[[d[4]]],"queueNameTaskId"]).next().then(function(a,b){b=a.done;a=a.value;return b?d[31]=!0:(a.item,d[31]=!0)})},function(a){return c.fe(c.db.table(2).fetch([[[d[4]]],"queueNameTaskId"]),function(a){var e=a.item;return d[42]=e.taskId,d[40]=e.context,d[43]=e.failureCount,d[41]=e.timeoutTimestampMs,d[23]=e.httpUrlOverride===d[29]&&!0===d[31]&&d[23],d[23]?c.seq([function(a){return d[40]===f?c.seq([function(a){return c.fe(c.db.table(2).fetch([[[d[42]]]]),function(a){return a["delete"]()})},function(a){return d[44]=f}]):c.seq([function(a){return c.i64.neq(d[41],f)?d[49]=c.i64.ge(c.i64.of_float(Date.now()),d[41]):d[49]=!1,d[49]?c.seq([function(a){return c.fe(c.db.table(2).fetch([[[d[42]]]]),function(a){return a["delete"]()})},function(a){return d[50]=f}]):c.seq([function(a){return c.seq([function(a){return d[40]==="46"?c.seq([function(a){return c.sp(b("LSTaskSerializerSendMessageV2"),d[42]).then(function(a){return a=a,d[58]=a[0],d[59]=a[1],a})},function(a){return a=[d[58],c.i64.to_string(d[59])],d[54]=a[0],d[55]=a[1],a}]):c.seq([function(a){return d[40]==="144"?c.seq([function(a){return c.sp(b("LSTaskSerializerMuteThreadV2"),d[42]).then(function(a){return a=a,d[60]=a[0],d[61]=a[1],a})},function(a){return a=[d[60],c.i64.to_string(d[61])],d[58]=a[0],d[59]=a[1],a}]):c.seq([function(a){return d[40]==="146"?c.seq([function(a){return c.sp(b("LSTaskSerializerRemoveThread"),d[42]).then(function(a){return a=a,d[62]=a[0],d[63]=a[1],a})},function(a){return a=[d[62],c.i64.to_string(d[63])],d[60]=a[0],d[61]=a[1],a}]):c.seq([function(a){return d[40]==="32"?c.seq([function(a){return c.seq([function(a){return c.db.table(32).fetch([[[d[42]]]]).next().then(function(a,b){var e=a.done;a=a.value;return e?(d[69]=c.createArray(),d[70]=(d[69].push("taskSerializerUpdateThreadName: Task ID not found"),d[69]),d[71]=(d[69].push(d[42]),d[69]),d[72]=c.toJSON(d[69]),function(a){c.logger(a).mustfix(a)}(d[72]),e=[f,f],d[66]=e[0],d[67]=e[1],e):(b=a.item,c.seq([function(a){return d[72]=b.threadKey,c.db.table(9).fetch([[[d[72]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?(d[73]=c.createArray(),d[74]=(d[73].push("taskSerializerUpdateThreadName: Thread not found"),d[73]),d[75]=(d[73].push(d[72]),d[73]),d[76]=c.toJSON(d[73]),function(a){c.logger(a).mustfix(a)}(d[76]),a=[f,f],d[69]=a[0],d[70]=a[1],a):(e=b.item,c.seq([function(a){return c.db.table(9).fetch([[[d[72]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?d[73]=[0,1]:(e=b.item,d[78]=e.syncGroup,c.i64.neq(d[78],f)?d[77]=d[78]:d[77]=[0,1],d[73]=d[77])})},function(a){return d[75]=new c.Map(),d[75].set("thread_key",d[72]),d[75].set("thread_name",e.threadName==null?"":e.threadName),d[75].set("sync_group",d[73]),d[76]=c.toJSON(d[75]),a=[d[76],[0,32]],d[69]=a[0],d[70]=a[1],a}]))})},function(a){return a=[d[69],d[70]],d[66]=a[0],d[67]=a[1],a}]))})},function(a){return a=[d[66],d[67]],d[64]=a[0],d[65]=a[1],a}])},function(a){return a=[d[64],c.i64.to_string(d[65])],d[62]=a[0],d[63]=a[1],a}]):c.seq([function(a){return d[40]==="362"?c.resolve((a=[f,f],d[66]=a[0],d[67]=a[1],a,a=[d[66],c.i64.to_string(d[67])],d[64]=a[0],d[65]=a[1],a)):c.seq([function(a){return d[40]==="50015"?c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure]Beginning execution."),c.db.table(168).fetch().next().then(function(a,e){var h=a.done;a=a.value;return h?(h=[f,f],d[70]=h[0],d[71]=h[1],h):(e=a.item,c.seq([function(a){return d[75]=e.deviceId,c.i64.neq(d[75],f)?c.seq([function(a){return c.db.table(190).fetch([[[d[42]]]]).next().then(function(e,i){var a=e.done;e=e.value;return a?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure]No restore payload context found."),a=[f,f],d[76]=a[0],d[77]=a[1],a):(i=e.item,c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure]Beginning execution."),c.ct(c.ftr(c.db.table(169).fetch(),function(a){return c.i64.eq(a.epochStatus,[0,1])&&c.i64.eq(a.authorityLevel,[0,80])})).then(function(a){return d[83]=a})},function(a){return c.i64.le(d[83],[0,1])?c.seq([function(a){return c.ftr(c.db.table(169).fetch(),function(a){return c.i64.eq(a.epochStatus,[0,1])&&c.i64.eq(a.authorityLevel,[0,80])}).next().then(function(e,i){var a=e.done;e=e.value;return a?c.seq([function(a){return d[88]=function(a){return a==f?f:a}(b("qex")._("2159")),d[88]!==f?d[87]=d[88]:d[87]=!1,d[87]===!1?function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure]Epoch rotation is disabled but open epoch count is not 1. Executing sync"):0,c.sp(b("LSSyncEpochs"))},function(a){return d[85]=f}]):(i=e.item,d[87]=new c.Map(),d[87].set("epoch_id",i.epochId),d[87].set("epoch_root_key",i.epochRootKeyBlob),d[87].set("epoch_anon_id",i.epochAnonIdBlob),d[85]=d[87])})},function(a){return d[84]=d[85]}]):c.seq([function(a){return function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsSecureEncryptedBackupsEpochsTable]Error! More than 1 open epoch was found. Calling the sync flow and returning empty results"),c.sp(b("LSSyncEpochs"))},function(a){return c.ftr(c.db.table(169).fetch(),function(a){return!1}).next().then(function(e,i){var a=e.done;e=e.value;return a?c.seq([function(a){return d[88]=function(a){return a==f?f:a}(b("qex")._("2159")),d[88]!==f?d[87]=d[88]:d[87]=!1,d[87]===!1?function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure]Epoch rotation is disabled but open epoch count is not 1. Executing sync"):0,c.sp(b("LSSyncEpochs"))},function(a){return d[85]=f}]):(i=e.item,d[87]=new c.Map(),d[87].set("epoch_id",i.epochId),d[87].set("epoch_root_key",i.epochRootKeyBlob),d[87].set("epoch_anon_id",i.epochAnonIdBlob),d[85]=d[87])})},function(a){return d[84]=d[85]}])},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsGetOpenEpochKeysStoredProcedure]Finishing execution."),d[79]=d[84]}])},function(a){return d[79]!==f?(d[83]=d[79].get("epoch_id"),d[79],d[80]=d[83]):d[80]=f,d[81]=new c.Map(),d[81].set("content_type",i.contentType),d[81].set("device_id",d[75]),d[81].set("epoch_id",d[80]),d[81].set("list_id",i.listId),d[81].set("num_items",i.numItems),d[81].set("start_sort_key",i.startSortKey),d[81].set("mailbox_partial_id",i.mailboxPartialId),d[81].set("trace_id",i.traceId),d[82]=c.toJSON(d[81]),a=[d[82],[0,50015]],d[76]=a[0],d[77]=a[1],a}]))})},function(a){return a=[d[76],d[77]],d[73]=a[0],d[74]=a[1],a}]):c.resolve((function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure]Unexpected error: Device ID is null."),a=[f,f],d[73]=a[0],d[74]=a[1],a))},function(a){return a=[d[73],d[74]],d[70]=a[0],d[71]=a[1],a}]))})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupsRestoreWithSerializerStoredProcedure]Finishing execution."),a=[d[70],d[71]],d[68]=a[0],d[69]=a[1],a}])},function(a){return a=[d[68],c.i64.to_string(d[69])],d[66]=a[0],d[67]=a[1],a}]):c.seq([function(a){return d[40]==="319"?c.seq([function(a){return c.seq([function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure]Beginning execution."),c.db.table(177).fetch([[[d[42]]],"fk_pending_tasks"]).next().then(function(a,e){var h=a.done;a=a.value;return h?c.seq([function(a){return c.db.table(2).fetch([[[d[42]]]]).next().then(function(b,e){var a=b.done;b=b.value;return a?(function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure]Task not found."),d[79]=f):(e=b.item,d[79]=e.dataTraceId)})},function(a){return d[81]="Pending backup context not found",d[81]!==f?c.seq([function(a){return d[84]=["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure]","",d[81]].join(""),function(a){c.logger(a).mustfix(a)}(d[84]),d[79]!==f?c.seq([function(a){return d[79]!==f?c.sp(b("LSAppendDataTraceAddon"),d[79],[0,85],[0,2],d[84],f):c.resolve()},function(a){return d[85]=!1,d[85]?d[86]=!0:d[86]=!1,d[86]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(a){return d[79]!==f?c.nop(b("LSFlushDataTrace.bs"),d[79]):c.resolve()},function(a){return d[82]=!1,d[82]?d[83]=!0:d[83]=!1,d[83]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.seq([function(a){return d[79]!==f?c.seq([function(a){return d[79]!==f?c.sp(b("LSAppendDataTraceAddon"),d[79],[0,85],[0,2],["[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure]","",""].join(""),f):c.resolve()},function(a){return d[84]=!1,d[84]?d[85]=!0:d[85]=!1,d[85]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}]):c.resolve()},function(a){return d[79]!==f?c.nop(b("LSFlushDataTrace.bs"),d[79]):c.resolve()},function(a){return d[82]=!1,d[82]?d[83]=!0:d[83]=!1,d[83]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0}])},function(a){return d[72]=f}]):(e=a.item,d[72]=e.lsTraceId)})},function(a){return d[72]!==f?c.sp(b("LSAppendDataTraceAddon"),d[72],[0,1451],[0,2],f,f):c.resolve()},function(a){return d[74]=!1,d[74]?d[75]=!0:d[75]=!1,d[75]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0,d[72]!==f?0:function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure]Trace ID is null"),c.db.table(177).fetch([[[d[42]]],"fk_pending_tasks"]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[76]=f:(b=a.item,d[76]=b.echoContent)})},function(a){return c.nop(b("LSSerializeBackupPayloadIndirection.bs"),d[42],d[76],d[72]).then(function(a){return a=a,d[78]=a[0],a})},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsTaskSerializerEncryptedBackupActionStoredProcedure]Finishing execution."),a=[d[78],[0,319]],d[70]=a[0],d[71]=a[1],a}])},function(a){return a=[d[70],c.i64.to_string(d[71])],d[68]=a[0],d[69]=a[1],a}]):c.resolve((a=[e.taskValue,d[40]],d[68]=a[0],d[69]=a[1],a))},function(a){return a=[d[68],d[69]],d[66]=a[0],d[67]=a[1],a}])},function(a){return a=[d[66],d[67]],d[64]=a[0],d[65]=a[1],a}])},function(a){return a=[d[64],d[65]],d[62]=a[0],d[63]=a[1],a}])},function(a){return a=[d[62],d[63]],d[60]=a[0],d[61]=a[1],a}])},function(a){return a=[d[60],d[61]],d[58]=a[0],d[59]=a[1],a}])},function(a){return a=[d[58],d[59]],d[54]=a[0],d[55]=a[1],a}])},function(a){return d[31]?(a=[d[54],d[55]],d[56]=a[0],d[57]=a[1],a):(a=[f,f],d[58]=a[0],d[59]=a[1],a,a=[d[58],c.i64.to_string(d[59])],d[56]=a[0],d[57]=a[1],a),a=[d[56],d[57]],d[51]=a[0],d[52]=a[1],a}])},function(a){return d[51]!==f?(d[54]=new c.Map(),d[54].set("label",d[52]),d[54].set("payload",d[51]),d[54].set("queue_name",e.queueName),d[54].set("task_id",d[42]),d[54].set("failure_count",c.i64.eq(d[43],[0,0])?f:d[43]),d[53]=d[54]):d[53]=f,d[50]=d[53]}])},function(a){return d[44]=d[50]}])},function(a){return d[44]?d[45]=!1:d[45]=!0,d[45]?0:d[49]=(d[22].push(d[44]),d[22]),d[46]=c.i64.of_int32(d[22].length),b("gkx")("6280")?d[47]=[0,50]:d[47]=[0,5],d[40]!==f?d[48]=["90","130","153"].includes(d[40]):d[48]=!1,d[23]=!(c.i64.ge(d[46],d[47])||d[48])}]):c.resolve()})},function(a){return d[33]=c.i64.of_int32(d[22].length),c.i64.eq(d[33],[0,0])?c.resolve((a=[d[4],f,[0,4],f,f,!1],d[34]=a[0],d[35]=a[1],d[36]=a[2],d[37]=a[3],d[38]=a[4],d[39]=a[5],a)):c.seq([function(a){return d[40]=c.i64.random(),d[50]=c.i64.and_(c.i64.or_(c.i64.lsl_(c.i64.of_float(Date.now()),c.i64.to_int32([0,22])),c.i64.and_(d[40],[0,4194303])),[2147483647,4294967295]),c.db.table(3).fetch([[[d[4],[-1,4294967295]]]]).next().then(function(a,b){b=a.done;a=a.value;return b?c.db.table(3).add({syncDatabaseId:[-1,4294967295],taskQueueName:d[4],failureCount:[0,0],lastSentTimestampMs:[0,0],lastSyncRequestTimestampMs:c.i64.of_float(Date.now()),epochId:d[50]}):(a.item,c.fe(c.db.table(3).fetch([[[d[4],[-1,4294967295]]]]),function(a){var b=a.update;a.item;return b({epochId:d[50],lastSyncRequestTimestampMs:c.i64.of_float(Date.now())})}))})},function(a){return c.islc(c.db.table(2).fetch([[[d[4]]],"queueNameTaskId"]),0,c.i64.to_float([0,1])).next().then(function(a,b){var c=a.done;a=a.value;return c?(c=["",[-1,4294967295],[0,0],[-1,4294967295],f,f],d[42]=c[0],d[43]=c[1],d[44]=c[2],d[45]=c[3],d[46]=c[4],d[47]=c[5],c):(b=a.item,c=[b.queueName,b.minTimeToSyncTimestampMs,b.pluginType,b.failureCount,b.context,b.httpUrlOverride],d[42]=c[0],d[43]=c[1],d[44]=c[2],d[45]=c[3],d[46]=c[4],d[47]=c[5],c)})},function(a){return d[49]=new c.Map(),d[49].set("tasks",d[22]),d[49].set("epoch_id",d[50]),a=[d[4],f,[0,1],d[49],d[47],!(d[47]===f)||c.i64.gt(d[45],[0,7])],d[34]=a[0],d[35]=a[1],d[36]=a[2],d[37]=a[3],d[38]=a[4],d[39]=a[5],a}])},function(a){return a=[d[34],d[35],d[36],d[37],d[38],d[39]],d[15]=a[0],d[16]=a[1],d[17]=a[2],d[18]=a[3],d[19]=a[4],d[20]=a[5],a}])},function(a){return d[21]=new c.Map(),d[21].set("queue_name",d[15]),d[21].set("next_sync_ms",d[16]),d[21].set("work_item_type",d[17]),d[21].set("network_payload",d[18]),d[21].set("http_url_override",d[19]),d[21].set("skip_realtime_gateway",d[20]),d[3]=d[21]}])}])},function(a){return e[0]=d[3]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSBeginHandlingPendingTasks",["LSBeginHandlingPendingTasksForQueue"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(g){return c.seq([function(e){return d[0]=c.createArray(),c.gb(c.db.table(2).fetch([[[]],"queueNameTaskId"]),"queueName").forEach(function(e){return c.seq([function(f){return c.sp(b("LSBeginHandlingPendingTasksForQueue"),e.queueName,a[0]).then(function(a){return a=a,d[1]=a[0],a})},function(a){return d[2]=(d[0].push(d[1]),d[0])}])})},function(a){return c.gb(c.sb(c.db.table(5).fetch(),[["queueName","ASC"]]),"queueName").forEach(function(a){return d[1]=a.queueName,c.seq([function(a){return d[2]=c.createArray(),c.fe(c.ftr(c.db.table(5).fetch(),function(a){return a.queueName===d[1]}),function(a){a=a.item;return d[5]=new c.Map(),d[5].set("label",a.context),d[5].set("payload",a.taskValue),d[5].set("queue_name",a.queueName),d[5].set("task_id",a.taskId),d[5].set("failure_count",c.i64.eq([0,0],[0,0])?f:[0,0]),d[6]=(d[2].push(d[5]),d[2])})},function(a){return d[3]=new c.Map(),d[3].set("tasks",d[2]),d[3].set("epoch_id",f),d[4]=new c.Map(),d[4].set("queue_name",d[1]),d[4].set("next_sync_ms",f),d[4].set("work_item_type",[0,5]),d[4].set("network_payload",d[3]),d[4].set("http_url_override",f),d[4].set("skip_realtime_gateway",!1),d[5]=(d[0].push(d[4]),d[0])}])})},function(a){return c.fe(c.db.table(5).fetch(),function(a){return a["delete"]()})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSBeginHandlingSyncForSyncGroup",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d=[],e;return b.seq([function(f){return b.seq([function(d){return b.db.table(1).fetch([[[a[0]]]]).next().then(function(a,d){var f=a.done;a=a.value;return f?c[0]=e:(d=a.item,c[9]=new b.Map(),c[9].set("group_id",d.groupId),c[9].set("current_cursor",d.currentCursor),c[9].set("sync_status",d.syncStatus),c[9].set("sync_params",d.syncParams),c[9].set("send_sync_params",d.sendSyncParams),c[9].set("min_time_to_sync_timestamp_ms",d.minTimeToSyncTimestampMs),c[9].set("can_ignore_timestamp",d.canIgnoreTimestamp),c[9].set("sync_channel",d.syncChannel),c[9].set("last_sync_request_timestamp_ms",d.lastSyncRequestTimestampMs),c[0]=c[9])})},function(d){return c[0]?c[2]=!1:c[2]=!0,c[2]?b.resolve((d=[a[0],e,[0,4],e,!1],c[3]=d[0],c[4]=d[1],c[5]=d[2],c[6]=d[3],c[7]=d[4],d)):b.seq([function(a){return c[9]=c[0].get("group_id"),c[0],b.ftr(b.db.table(3).fetch(),function(a){return b.i64.neq(a.epochId,e)&&b.i64.eq(a.syncDatabaseId,c[9])}).next().then(function(a,b){b=a.done;a=a.value;return b?c[10]=!1:(a.item,c[10]=!0)})},function(d){return c[10]?b.resolve((c[17]=c[0].get("group_id"),c[0],d=[c[17],e,[0,4],e,!1],c[12]=d[0],c[13]=d[1],c[14]=d[2],c[15]=d[3],c[16]=d[4],d)):b.seq([function(d){return c[27]=b.i64.of_float(Date.now()),c[17]=c[0].get("min_time_to_sync_timestamp_ms"),c[0],c[18]=c[0].get("last_sync_request_timestamp_ms"),c[0],c[19]=c[0].get("can_ignore_timestamp"),c[0],c[19]&&a[1]||b.i64.ge(c[27],c[17])?b.seq([function(d){return a[1]?b.resolve(c[28]=[0,0]):b.seq([function(a){return c[29]=c[0].get("group_id"),c[0],b.db.table(3).fetch([[["",c[29]]]]).next().then(function(a,b){var d=a.done;a=a.value;return d?c[30]=[0,0]:(b=a.item,c[30]=b.failureCount)})},function(a){return c[32]=b.i64.mul(b.i64.sub(b.i64.lsl_([0,1],b.i64.to_int32(b.i64.lt([0,15],c[30])?[0,15]:c[30])),[0,1]),[0,500]),c[33]=b.i64.sub(b.i64.add(c[18]==null?[0,0]:c[18],b.i64.lt(c[32],[0,3e4])?c[32]:[0,3e4]),c[27]),c[28]=b.i64.gt(c[33],[0,0])?c[33]:[0,0]}])},function(a){return c[20]=c[28]}]):b.resolve(c[20]=b.i64.sub(c[17],c[27]))},function(a){return c[21]=c[0].get("group_id"),c[0],b.i64.gt(c[20],[0,0])?b.seq([function(a){return b.fe(b.ftr(b.db.table(3).fetch(),function(a){return b.i64.eq(a.syncDatabaseId,c[21])}),function(a){var c=a.update;a.item;return c({lastDelayedRequestTimestampMs:b.i64.of_float(Date.now())})})},function(a){return a=[c[21],c[20],[0,3],e,!1],c[22]=a[0],c[23]=a[1],c[24]=a[2],c[25]=a[3],c[26]=a[4],a}]):b.seq([function(a){return b.fe(b.db.table(1).fetch([[[c[21]]]]),function(a){var c=a.update;a.item;return c({lastSyncRequestTimestampMs:b.i64.of_float(Date.now())})})},function(a){return b.fe(b.ftr(b.db.table(3).fetch(),function(a){return b.i64.eq(a.syncDatabaseId,c[21])}),function(a){var c=a.update;a.item;return c({lastSyncRequestTimestampMs:b.i64.of_float(Date.now())})})},function(a){return c[28]=c[0].get("group_id"),c[0],c[29]=b.i64.random(),c[42]=b.i64.and_(b.i64.or_(b.i64.lsl_(b.i64.of_float(Date.now()),b.i64.to_int32([0,22])),b.i64.and_(c[29],[0,4194303])),[2147483647,4294967295]),b.db.table(3).fetch([[["",c[28]]]]).next().then(function(a,d){d=a.done;a=a.value;return d?b.db.table(3).add({syncDatabaseId:c[28],taskQueueName:"",failureCount:[0,0],lastSentTimestampMs:[0,0],lastSyncRequestTimestampMs:[0,0],epochId:c[42]}):(a.item,b.fe(b.db.table(3).fetch([[["",c[28]]]]),function(a){var b=a.update;a.item;return b({epochId:c[42]})}))})},function(a){return c[31]=c[0].get("group_id"),c[0],b.db.table(3).fetch([[["",c[31]]]]).next().then(function(a,b){var d=a.done;a=a.value;return d?c[32]=[0,0]:(b=a.item,c[32]=b.failureCount)})},function(a){return c[34]=c[0].get("send_sync_params"),c[0],c[35]=c[0].get("sync_params"),c[0],c[36]=c[0].get("current_cursor"),c[0],c[37]=new b.Map(),c[37].set("database",c[31]),c[37].set("version",[-1,4294967295]),c[37].set("epoch_id",c[42]),c[37].set("last_applied_cursor",c[36]),c[37].set("sync_params",c[34]?c[35]:e),c[37].set("failure_count",b.i64.gt(c[32],[0,0])?c[32]:e),c[38]=c[0].get("current_cursor"),c[0],e===c[38]?c[39]=[0,1]:c[39]=[0,2],c[40]=new b.Map(),c[40].set("type",c[39]),c[40].set("request_payload",c[37]),c[41]=c[0].get("sync_channel"),c[0],a=[c[28],e,[0,1],c[40],b.i64.eq(c[41],[0,2])],c[22]=a[0],c[23]=a[1],c[24]=a[2],c[25]=a[3],c[26]=a[4],a}])},function(a){return a=[c[22],c[23],c[24],c[25],c[26]],c[12]=a[0],c[13]=a[1],c[14]=a[2],c[15]=a[3],c[16]=a[4],a}])},function(a){return a=[c[12],c[13],c[14],c[15],c[16]],c[3]=a[0],c[4]=a[1],c[5]=a[2],c[6]=a[3],c[7]=a[4],a}])},function(a){return c[8]=new b.Map(),c[8].set("sync_group_id",c[3]),c[8].set("next_sync_ms",c[4]),c[8].set("work_item_type",c[5]),c[8].set("network_payload",c[6]),c[8].set("skip_realtime_gateway",c[7]),d[0]=c[8]}])},function(a){return b.resolve(d)}])}e.exports=a}),null);
__d("LSBeginHandlingSync",["LSBeginHandlingSyncForSyncGroup"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[];return c.seq([function(f){return c.seq([function(e){return d[0]=c.createArray(),c.fe(c.db.table(1).fetch(),function(e){var f=e.item;return c.seq([function(e){return c.sp(b("LSBeginHandlingSyncForSyncGroup"),f.groupId,a[0]).then(function(a){return a=a,d[1]=a[0],a})},function(a){return d[2]=(d[0].push(d[1]),d[0])}])})},function(a){return e[0]=d[0]}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSHandleTaskSendSuccessForQueue",[],(function(a,b,c,d,e,f){function a(){var a=arguments,b=a[a.length-1];b.n;var c=[],d;return b.seq([function(c){return b.fe(b.ftr(b.db.table(3).fetch([[[a[0],[-1,4294967295]]]]),function(c){return c.taskQueueName===a[0]&&b.i64.eq(c.syncDatabaseId,[-1,4294967295])&&!b.i64.eq(c.epochId,d)}),function(a){return a["delete"]()})},function(a){return b.resolve(c)}])}e.exports=a}),null);
__d("LSFetchBackupIds",["LSAppendDataTraceAddon","LSCreateDataTraceID.bs","LSIssueNewTask"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(e){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure]Beginning execution."),c.seq([function(e){return a[1]!==f?c.seq([function(b){return d[5]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils]",d[5],"EncryptedBackups Trace ID",d[5],c.i64.to_string([0,69])].join("")),c.db.table(153).add({traceId:a[1],initTimestampMs:c.i64.of_float(Date.now()),traceType:[0,69],shouldFlush:!1,contextThree:"fetch_backup_status"})},function(b){return d[0]=a[1]}]):c.seq([function(a){return c.islc(c.ftr(c.db.table(168).fetch(),function(a){return c.i64.eq(a.authorityLevel,[0,80])&&c.i64.eq(a.backupTenancy,[0,2])}),0,c.i64.to_float([0,1])).next().then(function(a,b){b=a.done;a=a.value;return b?d[5]=!1:(a.item,d[5]=!0)})},function(a){return d[5]?d[7]=c.i64.or_([0,69],[0,128]):d[7]=[0,69],c.nop(b("LSCreateDataTraceID.bs")).then(function(a){return a=a,d[8]=a[0],a})},function(a){return d[9]="",function(a){c.logger(a).info(a)}(["[EncryptedBackups][MEBTraceUtils]",d[9],"EncryptedBackups Trace ID",d[9],c.i64.to_string(d[7])].join("")),c.db.table(153).add({traceId:d[8],initTimestampMs:c.i64.of_float(Date.now()),traceType:d[7],shouldFlush:!1,contextThree:"fetch_backup_status"})},function(a){return d[10]=!1,d[10]?d[11]=!0:d[11]=!1,d[11]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0,d[0]=d[8]}])},function(a){return d[0]!==f?c.sp(b("LSAppendDataTraceAddon"),d[0],[0,1468],[0,2],f,f):c.resolve()},function(a){return d[1]=!1,d[1]?d[2]=!0:d[2]=!1,d[2]?function(a){c.logger(a).mustfix(a)}("[EncryptedBackups][MEBTraceUtils]LSDataTraceMciTraceLog native op not supported"):0,c.fe(c.db.table(172).fetch(),function(a){return a["delete"]()})},function(a){return c.fe(c.ftr(c.db.table(172).fetch([[[[0,1]]]]),function(a){return c.i64.eq(a.pk,[0,1])&&c.i64.lt(a.authorityLevel,[0,20])}),function(a){return a["delete"]()})},function(b){return c.db.table(172).add({pk:[0,1],authorityLevel:[0,20],backupTenancy:a[0]})},function(e){return d[3]=new c.Map(),d[3].set("backup_tenancy",a[0]),d[3].set("trace_id",d[0]),d[4]=c.toJSON(d[3]),c.sp(b("LSIssueNewTask"),"encrypted_backups_setup",[0,50008],d[4],f,f,[0,0],[0,0],f,f,[0,0])}])},function(a){return function(a){c.logger(a).info(a)}("[EncryptedBackups][LSEncryptedBackupsFetchBackupIdsStoredProcedure]Finishing execution.")}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("LSUpdateCommunityChannelDirectInvite",["LSIssueNewError","LSIssueNewTaskAndGetTaskID"],(function(a,b,c,d,e,f){function a(){var a=arguments,c=a[a.length-1];c.n;var d=[],e=[],f;return c.seq([function(e){return c.seq([function(a){return c.sb(c.db.table(115).fetch(),[["timestampMs","DESC"]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[0]=!1:(b=a.item,d[0]=b.errorShouldBeShown)})},function(a){return d[0]===!0?(d[11]=c.localizeV2([0,2285622730],f),d[12]=c.localizeV2([0,1919524925],f),c.sp(b("LSIssueNewError"),f,[0,1545093],d[11],d[12],f)):c.resolve()},function(e){return d[2]=new c.Map(),d[2].set("channel_id",a[0]),d[2].set("state",a[1]),c.i64.gt([0,0],[0,0])?d[3]=c.i64.add(c.i64.of_float(Date.now()),[0,0]):d[3]=[0,0],d[4]=d[2].get("channel_id"),d[2],d[5]=c.toJSON(d[2]),c.sp(b("LSIssueNewTaskAndGetTaskID"),["community_channel_invitation","_",c.i64.to_string(d[4])].join(""),[0,463],d[5],f,f,[0,0],[0,0],f,f,d[3]).then(function(a){return a=a,d[6]=a[0],a})},function(b){return c.db.table(9).fetch([[[a[0]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[7]=[-1,4294967295]:(b=a.item,d[7]=b.parentThreadKey)})},function(a){return c.db.table(162).fetch([[[d[7]]]]).next().then(function(a,b){var c=a.done;a=a.value;return c?d[9]=[-1,4294967295]:(b=a.item,d[9]=b.fbGroupId)})},function(b){return c.i64.eq(a[1],[0,1])?c.fe(c.ftr(c.db.table(162).fetch(),function(a){return c.i64.eq(a.fbGroupId,d[9])}),function(a){var b=a.update;a.item;return b({joiningChannelTaskId:d[6]})}):c.resolve()}])},function(a){return c.resolve(e)}])}e.exports=a}),null);
__d("MessengerCheckmark.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsxs("svg",babelHelpers["extends"]({fill:"currentColor",viewBox:"0 0 36 36",width:"1em",height:"1em"},a,{children:[a.title!=null&&h.jsx("title",{children:a.title}),a.children!=null&&h.jsx("defs",{children:a.children}),h.jsx("path",{fillRule:"evenodd",clipRule:"evenodd",d:"M26.378 9.169c.597.347.8 1.112.453 1.709l-9 15.5a1.25 1.25 0 0 1-1.965.256l-6.5-6.5a1.25 1.25 0 1 1 1.768-1.768l5.121 5.121a.25.25 0 0 0 .393-.05L24.67 9.621a1.25 1.25 0 0 1 1.709-.453z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MessengerCross.svg.react",["react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return h.jsxs("svg",babelHelpers["extends"]({fill:"currentColor",viewBox:"0 0 36 36",width:"1em",height:"1em"},a,{children:[a.title!=null&&h.jsx("title",{children:a.title}),a.children!=null&&h.jsx("defs",{children:a.children}),h.jsx("path",{d:"m12.631 25.138 5.196-5.189a.25.25 0 0 1 .353 0l5.197 5.189a1.241 1.241 0 0 0 1.76 0 1.241 1.241 0 0 0 0-1.761L19.95 18.18a.25.25 0 0 1 0-.354l5.189-5.196a1.241 1.241 0 0 0 0-1.76 1.241 1.241 0 0 0-1.761 0l-5.197 5.188a.25.25 0 0 1-.353 0l-5.196-5.189a1.241 1.241 0 0 0-1.76 0 1.241 1.241 0 0 0 0 1.761l5.188 5.196a.25.25 0 0 1 0 .354l-5.189 5.196a1.241 1.241 0 0 0 0 1.76 1.241 1.241 0 0 0 1.761 0z"})]}))}a.displayName=a.name+" [from "+f.id+"]";a._isSVG=!0;b=a;g["default"]=b}),98);
__d("MWUseAriaLabelForThread.bs",["fbt","MWPActor.bs","MWPGetThreadTitle.bs","ReQL.bs","ReQLSuspense","bs_belt_Option","react","useReStore"],(function(a,b,c,d,e,f,g){"use strict";var h,i=h||b("react");function a(a){var c=b("MWPActor.bs").useActor(void 0),d=b("useReStore")(),e=b("ReQLSuspense").useArray(function(){var c;return(c=b("ReQL.bs")).take(c.leftJoin(c.getKeyRange(c.fromTableAscending(d.table("participants")),{hd:a.threadKey,tl:0}),c.fromTableAscending(d.table("contacts"))),8)},[a.threadKey]);return i.useMemo(function(){var d=a.threadName;if(d!==void 0)return g._(/*FBT_CALL*/"Conversation titled {name of conversation}"/*FBT_CALL*/,[g._param("name of conversation",d)]).toString();d=b("bs_belt_Option").getWithDefault(b("MWPGetThreadTitle.bs").computeThreadTitle(void 0,a,e,c),"");return g._(/*FBT_CALL*/"Conversation with {participant list}"/*FBT_CALL*/,[g._param("participant list",d)]).toString()},[a.threadName,c])}f.useHook=a}),null);
__d("MessageRequestsBulkActionsThreadListItem.bs",["ix","CometPressable.react","JSSet.bs","MWIcon.react","MWPIsThreadUnread.bs","MWUseAriaLabelForThread.bs","MessageRequestsBulkActionsContext.react","bs_curry","bs_int64","fbicon","react","stylex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||b("react"),k={pressableContent:{borderTopStartRadius:"ue3kfks5",borderTopEndRadius:"pw54ja7n",borderBottomEndRadius:"uo3d90p7",borderBottomStartRadius:"l82x9zwi",display:"a8c37x1j",width:"k4urcfbm"},selectorWrapper:{display:"j83agx80",alignItems:"bp9cbjyn",paddingTop:"jb3vyjys",paddingEnd:"rv4hoivh",paddingBottom:"qt6c0cv9",paddingStart:"h4z51re5"},checkboxWrapper:{paddingRight:"l6okmz22"},threadItemContainerEditMode:{pointerEvents:"hzruof5a",flexGrow:"buofh1pr",minWidth:"hpfvmrgz"}};function a(a){var c=a.thread;a=a.threadListCell;var d=j.useContext(b("MessageRequestsBulkActionsContext.react")),e=d.setBulkActionsUnreadSelectedThreads,f=d.setBulkActionsSelectedThreads,h=d.bulkActionsSelectedThreads,l=b("bs_int64").to_string(c.threadKey),m=j.useCallback(function(a){return b("bs_curry")._1(f,function(a){a=new Set(b("JSSet.bs").values(a));if(a["delete"](l))return a;else return a.add(l)})});j.useEffect(function(){b("bs_curry")._1(e,function(a){a=new Set(b("JSSet.bs").values(a));if(b("MWPIsThreadUnread.bs").isThreadUnread(c)&&h.has(l))return a.add(l);else if(b("MWPIsThreadUnread.bs").isThreadUnread(c)){a["delete"](l);return a}else return a})},[h]);d=h.has(l);var n=b("MWUseAriaLabelForThread.bs").useHook(c);return j.jsx(b("CometPressable.react"),{"aria-label":n,role:"checkbox",onPress:function(a){return b("bs_curry")._1(m,void 0)},xstyle:function(a){return[k.pressableContent]},children:j.jsxs("div",{"aria-hidden":!0,className:(i||(i=b("stylex")))(k.selectorWrapper),children:[j.jsx("div",{className:i(k.checkboxWrapper),children:j.jsx(b("MWIcon.react"),{icon:d?b("fbicon")._(g("484757"),20):b("fbicon")._(g("659288"),20),color:d?"highlight":"disabled",hideHoverOverlay:!0})}),j.jsx("div",{className:i(k.threadItemContainerEditMode),children:a})]}),"aria-checked":d})}c=a;f.styles=k;f.make=c}),null);
__d("LSEncryptedBackupsBackupTenancy.bs",["bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";a=b("bs_caml_int64").one;c=[0,2];f.production=a;f.shadow=c}),null);
__d("MWEncryptedBackupsListenForChangesToBackupStateInitPath.bs",["LS.bs","LSEncryptedBackupsBackupTenancy.bs","LSFetchBackupIds","LSTransaction.bs","ReQL.bs","ReQLSubscription.bs","bs_curry","promiseDone"],(function(a,b,c,d,e,f){"use strict";function a(a){var c={contents:function(a){}},d=b("ReQL.bs").fromTableAscending(a.table("encrypted_backups_status_trigger"));c.contents=b("ReQLSubscription.bs").subscribe(a,d,function(c){b("promiseDone")(b("LSTransaction.bs").run(a,function(a){return b("LSFetchBackupIds")(b("LSEncryptedBackupsBackupTenancy.bs").production,void 0,b("LS.bs").make(a))},"readWrite"),void 0,void 0)});return function(a){return b("bs_curry")._1(c.contents,void 0)}}f.listenForChangesToBackupState=a}),null);
__d("MAWUnsupportedIndexedDBNuxKey",["WebStorage"],(function(a,b,c,d,e,f,g){"use strict";var h="maw_unsupported_browser_nux_dismissed",i="dismissed";a=function(){var a;return((a=c("WebStorage").getLocalStorageForRead())==null?void 0:a.getItem(h))===i};b=function(){var a;(a=c("WebStorage").getLocalStorage())==null?void 0:a.setItem(h,i)};g.getIsDismissed=a;g.setIsDismissed=b}),98);
__d("MWJewelThreadAddOnSecondaryIcons",["cr:1737009"],(function(a,b,c,d,e,f,g){"use strict";g.MWJewelThreadAddOnSecondaryIcons=b("cr:1737009")}),98);
__d("MWJewelThreadSnippet.react",["CurrentEnvironment","MDSText.react","TetraText.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){var b=a.isUnread;a=a.text;return b?c("CurrentEnvironment").facebookdotcom?h.jsx(c("TetraText.react"),{color:"highlight",numberOfLines:1,type:"bodyLink4",children:a}):c("MDSText.react")!=null?h.jsx(c("MDSText.react"),{color:"primary",numberOfLines:1,type:"entityHeaderMeta3",children:a}):h.jsx(c("TetraText.react"),{color:"primary",numberOfLines:1,type:"bodyLink4",children:a}):h.jsx(c("TetraText.react"),{color:"secondary",numberOfLines:1,type:"body4",children:a})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWJewelMessageRequestsThread.react",["fbt","ix","I64","Locale","LsSystemFolderInterop.re","MWJewelThreadSnippet.react","ReQL","ReQLSuspense","TetraIcon.react","TetraListCell.react","fbicon","react","useReStore"],(function(a,b,c,d,e,f,g,h,i){"use strict";var j=d("react"),k=function(){var a=c("useReStore")();return d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableDescending(a.table("threads").index("parentThreadKeyLastActivityTimestampMs")).getKeyRange(d("LsSystemFolderInterop.re").pending).filter(function(a){return d("I64").i64_gt(a.lastActivityTimestampMs,a.lastReadWatermarkTimestampMs)}).map(function(b){b=b.snippetSenderContactId;if(b!=null){b=d("ReQLSuspense").first(d("ReQL").fromTableAscending(a.table("contacts")).getKeyRange(b));return b?b.name:void 0}})},[a])};function a(a){var b=a.onOpenMessageRequests;a=a.unreadRequestsCount;var e=h._(/*FBT_CALL*/{"*":"New message requests","_1":"New message request"}/*FBT_CALL*/,[h._plural(a)]),f=h._(/*FBT_CALL*/{"someone":"From someone you may know","people":"From people you may know"}/*FBT_CALL*/,[h._enum(a===1?"someone":"people",{someone:"someone",people:"people"})]),g=k();g!=null&&(a===1?f=h._(/*FBT_CALL*/"From {name}"/*FBT_CALL*/,[h._param("name",g)]):f=h._(/*FBT_CALL*/"From {name} and {count} more"/*FBT_CALL*/,[h._param("name",g),h._param("count",a-1)]));return j.jsx(c("TetraListCell.react"),{addOnPrimary:{icon:d("fbicon")._(i("542884"),24),size:56,type:"contained-icon"},addOnSecondary:{addOn:j.jsx(c("TetraIcon.react"),{color:"secondary",icon:d("Locale").isRTL()?d("fbicon")._(i("492485"),16):d("fbicon")._(i("492533"),16)}),type:"body"},body:j.jsx(c("MWJewelThreadSnippet.react"),{isUnread:!0,text:f}),headline:e,level:4,onPress:b})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWLSLoadThreadFolderIfNotPresent.bs",["CancellablePromise.bs","CancellationToken.bs","MWLSJewelLoadMoreThreads.bs","Promise","ReQL.bs","bs_caml","promiseDone","react","useReStore"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react");function a(a){var c=b("useReStore")(),d=b("MWLSJewelLoadMoreThreads.bs").useHook(a);h.useEffect(function(){var e=b("CancellationToken.bs").make(void 0),f=b("CancellablePromise.bs").ignoreFailed(void 0,b("CancellablePromise.bs").then_(e,function(a){a!==void 0||d();return b("Promise").resolve(void 0)},b("ReQL.bs").first(b("ReQL.bs").filter(b("ReQL.bs").fromTableAscending(c.table("threads_ranges_v2__generated")),function(c){return b("bs_caml").i64_eq(c.parentThreadKey,a)}))));b("promiseDone")(f,void 0,void 0);return e.cancel},[d,c,JSON.stringify(a)])}f.useHook=a}),null);
__d("MWLSJewelMessageRequestsThread.bs",["LsSystemFolder.bs","MWJewelMessageRequestsThread.react","MWLSLoadThreadFolderIfNotPresent.bs","MWPActor.bs","ReQL.bs","ReQLSubscription.bs","bs_caml","react","useReStore"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react"),i=b("MWJewelMessageRequestsThread.react");c={make:i};function j(a){var c=b("useReStore")();a=b("MWPActor.bs").useActor(void 0);a=h.useMemo(function(){return b("ReQL.bs").filter(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromIndexDescending(c.table("threads").index("parentThreadKeyLastActivityTimestampMs")),{hd:b("LsSystemFolder.bs").pending,tl:0}),function(a){return b("bs_caml").i64_gt(a.lastActivityTimestampMs,a.lastReadWatermarkTimestampMs)})},[c,JSON.stringify(a)]);return b("ReQLSubscription.bs").useArray(a).length}function a(a){b("MWLSLoadThreadFolderIfNotPresent.bs").useHook(b("LsSystemFolder.bs").pending);var c=j(void 0);if(a!==void 0&&c>0)return h.jsx(i,{onOpenMessageRequests:a,unreadRequestsCount:c});else return null}f.RequestsThread=c;f.useHook=a}),null);
__d("TetraMWJewelThreadAddOnSecondaryIcons",["ix","TetraIcon.react","fbicon","react"],(function(a,b,c,d,e,f,g,h){"use strict";a=d("react");b=a.jsx(c("TetraIcon.react"),{color:"disabled",icon:d("fbicon")._(h("569284"),16)});g.bell=b}),98);
__d("MWJewelLightspeedSearchTypeaheadViewList.react",["CometScrollView.react","MWChatSearchLightspeedTypeaheadViewList.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i={scroll:{maxHeight:"nt8syekh"}};function a(a){var b=a.xstyle;a=babelHelpers.objectWithoutPropertiesLoose(a,["xstyle"]);return h.jsx(c("CometScrollView.react"),{showsHorizontalScrollIndicator:!1,xstyle:[i.scroll,b],children:h.jsx(c("MWChatSearchLightspeedTypeaheadViewList.react"),babelHelpers["extends"]({},a))})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWJewelSearchEmptyState.react",["fbt","TetraText.react","react","useCometTypeaheadEmptyState"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react");function a(a){var b=c("useCometTypeaheadEmptyState")();return b?i.jsxs("div",{className:"tw6a2znq f10w8fjw d1544ag0 pybr56ya",children:[i.jsx(c("TetraText.react"),{align:"center",type:"body2",children:h._(/*FBT_CALL*/"Nothing found"/*FBT_CALL*/)}),i.jsx("br",{}),i.jsx(c("TetraText.react"),{align:"center",color:"tertiary",type:"body3",children:h._(/*FBT_CALL*/"We couldn't find any matches for \"{query}\". Try checking for typos or using complete words."/*FBT_CALL*/,[h._param("query",a.queryString)])})]}):null}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWJewelSearchTypeaheadHelper.bs",["bs_caml_int64","bs_int64"],(function(a,b,c,d,e,f){"use strict";function a(a){return{resultIndex:b("bs_int64").to_string(a.globalIndex),resultType:b("bs_caml_int64").to_int32(a.type_),threadType:b("bs_caml_int64").to_int32(a.threadType),queryString:a.query,resultFbid:a.resultId}}f.getLoggingValues=a}),null);
__d("MWJewelSearchTypeaheadHelper.re",["MWJewelSearchTypeaheadHelper.bs"],(function(a,b,c,d,e,f){a=b("MWJewelSearchTypeaheadHelper.bs").getLoggingValues;f.getLoggingValues=a}),null);
__d("createMWJewelSearchTypeaheadViewStrategy.react",["CometTypeaheadProgressGlimmer.react","MWJewelLightspeedSearchTypeaheadViewList.react","MWJewelSearchEmptyState.react","MWJewelSearchTypeaheadViewItem.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(a){return function(b){var d=b.ariaProps,e=b.entries;b.extraViewProps;var f=b.highlightedEntry,g=b.isLoading;b.onAbandonTypeahead_DO_NOT_USE;var i=babelHelpers.objectWithoutPropertiesLoose(b,["ariaProps","entries","extraViewProps","highlightedEntry","isLoading","onAbandonTypeahead_DO_NOT_USE"]);b=e.length===0&&i.queryString.length>0;g=e.length>0&&g;return b?h.jsx(c("MWJewelSearchEmptyState.react"),{queryString:i.queryString}):h.jsxs(h.Fragment,{children:[h.jsx(c("MWJewelLightspeedSearchTypeaheadViewList.react"),{ariaProps:d,entries:e,highlightedEntry:f,xstyle:a,children:function(a){var b=a.entry,d=a.isActive;a=a.itemRole;return h.createElement(c("MWJewelSearchTypeaheadViewItem.react"),babelHelpers["extends"]({},i,{entry:b,isActive:d,key:b.key,role:a}))}}),g&&h.jsx(c("CometTypeaheadProgressGlimmer.react"),{})]})}}g["default"]=a}),98);
__d("MWLSMarkThreadAsRead.re",["MWLSMarkThreadAsRead.bs"],(function(a,b,c,d,e,f){a=b("MWLSMarkThreadAsRead.bs").useHook;f.useHook=a}),null);
__d("MAWUnsupportedBrowsersNuxWrapper.react",["CometPlaceholder.react","MAWUnsupportedIndexedDBNuxKey","WebStorage","cr:2883","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react"),i=d("react").useState;function a(a){var e=a.children;a=a.marginHorizontal;var f=i(d("MAWUnsupportedIndexedDBNuxKey").getIsDismissed()),g=f[0],j=f[1];f=window.indexedDB!=null&&c("WebStorage").getLocalStorage()!=null;return h.jsx(c("CometPlaceholder.react"),{fallback:null,children:b("cr:2883")==null||f||g?e:h.jsx(b("cr:2883"),{marginHorizontal:a,onCloseButtonClick:function(){j(!0),d("MAWUnsupportedIndexedDBNuxKey").setIsDismissed()}})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LsUniversalSearchEndFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f){"use strict";a=b("getFalcoLogPolicy_DO_NOT_USE")("92");c=b("FalcoLoggerInternal").create("ls_universal_search_end",a);e.exports=c}),null);
__d("LsUniversalSearchResultSelectedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f){"use strict";a=b("getFalcoLogPolicy_DO_NOT_USE")("95");c=b("FalcoLoggerInternal").create("ls_universal_search_result_selected",a);e.exports=c}),null);
__d("MWSearchLogging",["LsUniversalSearchEndFalcoEvent","LsUniversalSearchResultSelectedFalcoEvent","MWJewelSearchTypeaheadHelper.re"],(function(a,b,c,d,e,f,g){"use strict";var h=function(a){if(a==="offline"||a==="offline_nullstate"||a==="secure")return[0];return a==="server"?[1,2]:[]};function a(a,b,d,e){var f=d.rawData;d=f.id;var g=parseInt(d,10),i=2;if(g<=0)i=0;else{var j=d,k=5;g=f.serverSearchResult;if(g!=null){d=c("MWJewelSearchTypeaheadHelper.re").getLoggingValues(g);k=d.resultType;i=d.threadType;j=d.resultFbid}var l=((g=f.renderIndex)!=null?g:-1).toString();c("LsUniversalSearchResultSelectedFalcoEvent").log(function(){return{data_sources:h(f.searchSource),instance_id:a,recipient_ids:e,result_index_without_header:l,search_result:{query_string:b,result_fbid:j,result_index:l,result_type:k},thread_type:i,ui_section:0}})}c("LsUniversalSearchEndFalcoEvent").log(function(){return{end_action:6,instance_id:a,recipient_ids:e,thread_type:i}})}g.logResultSelected=a}),98);
__d("FDSMWMessageDeliveryStatusIcons.re",["FDSMWMessageDeliveryStatusIcons.bs"],(function(a,b,c,d,e,f){a=b("FDSMWMessageDeliveryStatusIcons.bs").DeliveredAndRead.make;f.DeliveredAndRead_make=a;c=b("FDSMWMessageDeliveryStatusIcons.bs").DeliveredAndRead;f.DeliveredAndRead=c}),null);
__d("MWMessageDeliveryStatusIcons",["cr:2698"],(function(a,b,c,d,e,f,g){"use strict";g["default"]=b("cr:2698")}),98);
__d("MWPThreadListItemInviteAddOn.react",["fbt","MDSCircleButton.react","MDSRow.react","MDSRowItem.react","MWPBumpEntityKey.re","MessengerCheckmark.svg.react","MessengerCross.svg.react","SVGIcon","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react"),j=h._(/*FBT_CALL*/"Accept invitation"/*FBT_CALL*/),k=h._(/*FBT_CALL*/"Decline invitation"/*FBT_CALL*/);a=function(a){var b=a.onAccept,e=a.onDecline;return i.jsxs(c("MDSRow.react"),{paddingHorizontal:0,paddingVertical:0,verticalAlign:"center",children:[i.jsx(c("MDSRowItem.react"),{children:i.jsx(c("MDSCircleButton.react"),{icon:d("SVGIcon").svgIcon(c("MessengerCheckmark.svg.react")),label:j,onPress:function(a){d("MWPBumpEntityKey.re").bumpEntityKeyWithAppId("mw.sidebar","thread_invite.accept"),b()},size:32})}),i.jsx(c("MDSRowItem.react"),{children:i.jsx(c("MDSCircleButton.react"),{icon:d("SVGIcon").svgIcon(c("MessengerCross.svg.react")),label:k,onPress:function(a){d("MWPBumpEntityKey.re").bumpEntityKeyWithAppId("mw.sidebar","thread_invite.decline"),e()},size:32})})]})};b=a;g["default"]=b}),98);
__d("MWThreadAddOnSecondary.react",["fbt","CometBadge.react","CometPressable.react","CurrentEnvironment","I64","LSMediaUrl.re","LSMessagingThreadTypeUtil.re","MAWGating.re","MWJewelThreadAddOnSecondaryIcons","MWLSMarkThreadAsRead.re","MWMessageDeliveryStatusIcons","MWPActor.re","ReQL","ReQLSuspense","TetraOverlappingFacepileUnstyled.react","react","useReStore"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react");function j(a){var b=c("useReStore")(),e=c("MWPActor.re").useActor();return d("ReQLSuspense").useArray(function(){return d("ReQL").fromTableAscending(b.table("participants").index("threadKeyReadWatermarkTimestampMs")).getKeyRange(a.threadKey).bounds({gte:{hd:a.lastActivityTimestampMs,tl:0}}).filter(function(a){a=a.contactId;return!d("I64").equal(a,e)}).take(3).map(function(a){a=a.contactId;a=d("ReQLSuspense").first(d("ReQL").fromTableAscending(b.table("contacts")).getKeyRange(a));return a!=null?{alt:a.name,source:{uri:c("LSMediaUrl.re").Contact.profilePictureUrl(a)}}:null})},[b,e,a.threadKey,a.lastActivityTimestampMs]).filter(Boolean)}function a(a){var b=a.isMuted,e=a.isUnread,f=a.isViewerSender,g=a.lastMessageDeliveryStatusIcon;a=a.thread;var k=c("MWLSMarkThreadAsRead.re").useHook(),l=j(a),m=[];a=c("LSMessagingThreadTypeUtil.re").isSecure(a.threadType)&&c("LSMessagingThreadTypeUtil.re").isGroup(a.threadType);b&&m.push(d("MWJewelThreadAddOnSecondaryIcons").MWJewelThreadAddOnSecondaryIcons.bell);e?m.push(i.jsx(c("CometPressable.react"),{"aria-label":h._(/*FBT_CALL*/"Mark as read"/*FBT_CALL*/),expanding:!0,onPress:function(a){return k()},children:i.jsx(c("CometBadge.react"),{color:"blue",isProfileBadge:!0,size:c("MAWGating.re").isArmadillo()&&c("CurrentEnvironment").messengerdotcom?10:12})})):f&&(l.length===0?g&&m.push(g):a?m.push(i.jsx(c("MWMessageDeliveryStatusIcons").DeliveredAndRead_make,{size:2,xstyle:null})):m.push(i.jsx(c("TetraOverlappingFacepileUnstyled.react"),{count:l.length,isTextInline:!0,items:l,screenReaderLabel:l.length===1?h._(/*FBT_CALL*/"Seen by {=personName}"/*FBT_CALL*/,[h._param("=personName",l[0].alt)]):h._(/*FBT_CALL*/{"*":"Seen by {=numPeople} people"}/*FBT_CALL*/,[h._param("=numPeople",l.length,[0])]),size:16})));return i.jsx("div",{className:"owycx6da j83agx80 bp9cbjyn",children:m.map(function(a,b){return i.jsxs(i.Fragment,{children:[b!==0?i.jsx("div",{className:"xthkpp0z"}):null,a]},"item_"+b.toString(10))})})}a.displayName=a.name+" [from "+f.id+"]";b=i.memo(a);g["default"]=b}),98);
__d("LSThreadRangeFilter.re",["LSThreadRangeFilter.bs"],(function(a,b,c,d,e,f){c=(a=b("LSThreadRangeFilter.bs")).none;f.none=c;d=a.unreadOnly;f.unreadOnly=d;e=a.groupsOnly;f.groupsOnly=e;b=a.igdProPrimary;f.igdProPrimary=b;c=a.igdProGeneral;f.igdProGeneral=c}),null);
__d("MWIsXacGroupThread.re",["MWIsXacGroupThread.bs"],(function(a,b,c,d,e,f){a=b("MWIsXacGroupThread.bs").check;f.check=a}),null);
__d("MWThreadListFocusableTable.react",["FocusTable.react","focusScopeQueries","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");a=d("FocusTable.react").createFocusTable(d("focusScopeQueries").tabbableScopeQuery);var i=a[0];b=a[1];c=a[2];e=function(a){return h.jsx(i,{allowModifiers:!0,tabScopeQuery:d("focusScopeQueries").tabbableScopeQuery,wrapX:!0,children:a.children})};g.MWThreadListFocusableTableRow=b;g.MWThreadListFocusableTableCell=c;g.MWThreadListFocusableTableScopeQuery=d("focusScopeQueries").tabbableScopeQuery;g.MWThreadListFocusableTable=e}),98);
__d("MWThreadListSupportedThreadTypes.re",["MWThreadListSupportedThreadTypes.bs"],(function(a,b,c,d,e,f){a=b("MWThreadListSupportedThreadTypes.bs").supportedThreadTypes;f.supportedThreadTypes=a}),null);
__d("MWPBaseThreadList.react",["I64","LS.re","LSFilteredThreadsRangesQuery","LSThreadRangeFilter.re","LSThreadsRangesQuery","MWIsXacGroupThread.re","MWPFolderFocusedManager.re","MWPMarkSeen.re","MWThreadListFocusableTable.react","MWThreadListSupportedThreadTypes.re","MWXacGating.re","ReQL","ReQLPaginatedList.react","ReQLSuspense","UserActivity","promiseDone","react","regeneratorRuntime","stylex","useReStore","useSimpleImpression","useVisibilityObserver"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");e=d("react");var i=e.useCallback,j=e.useEffect,k=e.useMemo,l=e.useRef,m={container:{display:"j83agx80",flexDirection:"cbu4d94t",flexGrow:"buofh1pr",overflowX:"ni8dbmo4",overflowY:"stjgntxs"},list:{display:"j83agx80",flexDirection:"cbu4d94t",flexGrow:"buofh1pr",overflowX:"ni8dbmo4",overflowY:"stjgntxs"}};function n(a,e,f){c("promiseDone")(a.runInTransaction(function(a){var g;return b("regeneratorRuntime").async(function(h){while(1)switch(h.prev=h.next){case 0:h.next=2;return b("regeneratorRuntime").awrap(a.table("threads_ranges_v2__generated").get(e));case 2:g=h.sent;if(!(g==null||g.isLoadingBefore)){h.next=5;break}return h.abrupt("return");case 5:f&&f();return h.abrupt("return",c("LSThreadsRangesQuery")(g.parentThreadKey,!0,!1,g.minThreadKey,g.maxThreadKey,g.maxLastActivityTimestampMs,g.minLastActivityTimestampMs,d("I64").zero,c("LS.re").make(a)));case 7:case"end":return h.stop()}},null,this)},"readwrite"))}function o(a,e,f,g,h){f===void 0&&(f=d("LSThreadRangeFilter.re").none),g===void 0&&(g=d("LSThreadRangeFilter.re").none),c("promiseDone")(a.runInTransaction(function(a){var d;return b("regeneratorRuntime").async(function(i){while(1)switch(i.prev=i.next){case 0:i.next=2;return b("regeneratorRuntime").awrap(a.table("filtered_threads_ranges_v2__generated").get(e));case 2:d=i.sent;if(!(d==null||d.isLoadingBefore)){i.next=5;break}return i.abrupt("return");case 5:h&&h();return i.abrupt("return",c("LSFilteredThreadsRangesQuery")(d.parentThreadKey,f,!0,!1,d.minThreadKey,d.maxThreadKey,d.maxLastActivityTimestampMs,d.minLastActivityTimestampMs,void 0,void 0,g,c("LS.re").make(a)));case 7:case"end":return i.stop()}},null,this)},"readwrite"))}function a(a){var b=a.afterContent,e=a.beforeContent,f=a.customThreadFilter_DO_NOT_USE,g=a.emptyContent,p=a.filter,q=a.gridLabel,r=a.onLoadMoreThreads,s=a.parentThreadKey,t=a.renderItem,u=a.renderLoadingAnimation,v=a.scrollAreaElementRef,w=a.secondaryFilter,x=c("useReStore")(),y=d("ReQLSuspense").useFirst(function(){if(p==null)return d("ReQL").fromTableDescending(x.table("threads_ranges_v2__generated")).getKeyRange(s);else return d("ReQL").fromTableDescending(x.table("filtered_threads_ranges_v2__generated")).getKeyRange(s).filter(function(a){return d("I64").equal(a.threadRangeFilter,p)&&(!w||d("I64").equal(a.secondaryThreadRangeFilter,w))})},[x,s,p,w]),z=y!=null?d("I64").equal(y.minLastActivityTimestampMs,d("I64").zero)||d("I64").equal(y.minLastActivityTimestampMs,d("I64").one)?null:y.minLastActivityTimestampMs:null,A=y!=null?d("I64").equal(y.maxLastActivityTimestampMs,d("I64").zero)||d("I64").equal(y.maxLastActivityTimestampMs,d("I64").one)?null:y.maxLastActivityTimestampMs:null,B=k(function(){return{gte:z==null?d("ReQL").key(s):d("ReQL").key(s,z),lte:A==null?d("ReQL").key(s):d("ReQL").key(s,A)}},[A,z,JSON.stringify(s)]),C=k(function(){var a=x.table("threads").index("parentThreadKeyLastActivityTimestampMs");function b(a){return a.filter(function(a){return d("MWThreadListSupportedThreadTypes.re").supportedThreadTypes.findIndex(function(b){return d("I64").equal(a.threadType,b)})!==-1&&(d("MWXacGating.re").isGroupsEnabled()||!d("MWIsXacGroupThread.re").check(a))&&(!f||f(a))})}var c=b(d("ReQL").fromTableAscending(a)),e=b(d("ReQL").fromTableDescending(a));return{entries:function(a,b,d){return(b==="asc"?c:e).iterator(a,d)},subscribe:function(a,b){var d=c.subscribe(function(b,c,d){return a(b,c,d)},b),f=e.subscribe(function(b,c,d){return a(b,c,d)},b);return function(){d(),f()}}}},[x,f]),D=d("ReQLSuspense").useFirst(function(){return d("ReQL").fromTableDescending(C).bounds(B)},[B,C])==null;j(function(){y==null&&c("promiseDone")(x.runInTransaction(function(a){if(p==null)return c("LSThreadsRangesQuery")(s,!0,!1,d("I64").max_int,d("I64").max_int,d("I64").max_int,d("I64").max_int,d("I64").zero,c("LS.re").make(a));else return c("LSFilteredThreadsRangesQuery")(s,p,!0,!1,d("I64").max_int,d("I64").max_int,d("I64").max_int,d("I64").max_int,void 0,void 0,w,c("LS.re").make(a))},"readwrite"))},[JSON.stringify(s),y,x,p,w]);var E=l(!1);a=c("useVisibilityObserver")({onHidden:function(){E.current=!1},onVisible:function(){E.current=!0}});d("MWPFolderFocusedManager.re").useWatchFocusChanges({isVisibleRef:E,parentThreadKey:s});var F=c("MWPMarkSeen.re").useHook({parentThreadKey:s});c("useSimpleImpression")(F);j(function(){return d("ReQL").fromTableDescending(x.table("threads").index("parentThreadKeyLastActivityTimestampMs")).getKeyRange(s).take(1).subscribe(function(){c("UserActivity").isOnTab()&&E.current===!0&&F()})},[x,JSON.stringify(s),F]);var G=i(function(){if(y==null)return;if(!y.threadRangeFilter){var a=d("ReQL").key(y.parentThreadKey,y.minThreadKey,y.minLastActivityTimestampMs);n(x,a,r)}else{a=d("ReQL").key(y.parentThreadKey,y.minThreadKey,y.minLastActivityTimestampMs,y.threadRangeFilter,y.folderName,y.secondaryThreadRangeFilter);o(x,a,p,w,r)}},[x,y,p,w,r]);return y==null?u!=null?u():null:h.jsx("div",{"aria-label":q,className:c("stylex")(m.container),"data-testid":void 0,ref:a,role:"grid",children:h.jsx(d("MWThreadListFocusableTable.react").MWThreadListFocusableTable,{children:h.jsx(c("ReQLPaginatedList.react"),{bounds:B,direction:"desc",hasReachedBottom:!y.hasMoreBefore,hasReachedTop:!y.hasMoreAfter,onReachingBottom:G,renderFooter:function(){return b},renderHeader:function(){return h.jsxs(h.Fragment,{children:[e,D&&!y.isLoadingAfter&&!y.isLoadingBefore&&g]})},renderItem:function(a){return h.jsx(h.Fragment,{children:t(a)},JSON.stringify(a.threadKey))},renderLoadingAnimation:u,scrollAreaElementRef:v,table:C,xstyle:m.list})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("MWPBaseThreadList.bs",["MWPBaseThreadList.react"],(function(a,b,c,d,e,f){"use strict";a=b("MWPBaseThreadList.react");f.make=a}),null);
__d("MWThreadListGlimmer.react",["BaseGlimmer.react","react"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");function a(){return h.jsxs("div",{className:"h4z51re5 osnr6wyh rv4hoivh jktsbyx5 j83agx80","data-testid":void 0,children:[h.jsx(c("BaseGlimmer.react"),{className:"tmrshh9y o3lre8g0 m7zwrmfr spb7xbtv bkmhp75w emlxlaya s45kfl79",index:0}),h.jsxs("div",{className:"taijpn5t buofh1pr cbu4d94t j83agx80",children:[h.jsx(c("BaseGlimmer.react"),{className:"n99xedck bi6gxh9e jnigpg78 l82x9zwi uo3d90p7 pw54ja7n ue3kfks5",index:1}),h.jsx(c("BaseGlimmer.react"),{className:"eq70wtua gl3lb2sf l82x9zwi uo3d90p7 pw54ja7n ue3kfks5",index:2})]})]})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("FBGroupChatInviteState.bs",["bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";a=b("bs_caml_int64").one;c=[0,2];d=[0,3];e=[0,4];b=[0,5];var g=[0,6];f.accepted=a;f.active=c;f.declinedByReceiver=d;f.ignoredByReceiver=e;f.deletedBySender=b;f.discarded=g}),null);
__d("MWThreadListLastMessage.bs",["fbt","CometGlimmer.react","CometMiddot.react","CometRelativeTimestamp.react","LSMessagingThreadTypeUtil.bs","Locale","MAWGating.bs","MAWLoadingStateContext","MDSLockSvgIcon.bs","MWJewelThreadSnippet.react","MWText.react","MWVerticalRhythm.bs","react","stylex"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||b("react"),k={timestampMiddot:{marginTop:"kvgmc6g5",marginEnd:"kady6ibp",marginBottom:"oygrvhab",marginStart:"dwxx2s2f"},lockIconMiddot:{"margin-left":"o2v3q0hd"},lockIcon:{color:"m9osqain","margin-right":"eblalovt"},root:{alignItems:"bp9cbjyn",display:"j83agx80",color:"m9osqain",minHeight:"frgo5egb"},rootRtl:{flexDirection:"rl25f0pe"},timestamp:{whiteSpace:"g0qnabr5"},bodyGlimmer:{borderTopStartRadius:"ue3kfks5",borderTopEndRadius:"pw54ja7n",borderBottomEndRadius:"uo3d90p7",borderBottomStartRadius:"l82x9zwi",height:"s62irw4c"},bodyGlimmerSecond:{width:"eq70wtua"}};function l(a){a=a.timestamp;return j.jsxs(j.Fragment,{children:[j.jsx("span",{className:(i||(i=b("stylex")))(k.timestampMiddot),children:j.jsx(b("MWText.react"),{color:"secondary",type:"body4",children:j.jsx(b("CometMiddot.react"),{})})}),j.jsx("span",{"data-testid":"timestamp",className:i(k.timestamp),children:j.jsx(b("CometRelativeTimestamp.react"),{date:new Date(a),format:"minimized"})})]})}c={make:l};function m(a){return j.jsxs(j.Fragment,{children:[j.jsx("span",{className:(i||(i=b("stylex")))(k.lockIconMiddot),children:j.jsx(b("MWText.react"),{color:"secondary",type:"body4",children:j.jsx(b("CometMiddot.react"),{})})}),j.jsx("span",{className:i(k.lockIcon),children:j.jsx(b("MDSLockSvgIcon.bs").make,{color:"secondary",size:String(16)})})]})}d={make:m};e={};function a(a){var c=a.hasOngoingCall,d=a.lastMessageTimestamp,e=a.snippet,f=a.isUnread,h=a.showTimestamp;a=a.thread;a=a!==void 0?b("LSMessagingThreadTypeUtil.bs").isSecure(a.threadType):!1;var n=j.useContext(b("MAWLoadingStateContext"));if(b("MAWGating.bs").isWebLoadStateEnabled(void 0)&&n&&a)return j.jsx(b("CometGlimmer.react"),{index:1,className:(i||(i=b("stylex")))(k.bodyGlimmer,k.bodyGlimmerSecond)});n=b("MAWGating.bs").isArmadillo(void 0);var o=b("MAWGating.bs").isPresenceEnabled(void 0);return j.jsxs(j.Fragment,{children:[j.jsxs("div",{"data-testid":"threadlist-last-message",className:(i||(i=b("stylex")))(k.root,b("Locale").isRTL()?k.rootRtl:!1),children:[j.jsx(b("MWJewelThreadSnippet.react"),{isUnread:f,text:e}),a&&n&&o?j.jsx(m,{}):null,h&&d!==void 0&&d>0?j.jsx(l,{timestamp:d}):null]}),c?j.jsxs(j.Fragment,{children:[b("MAWGating.bs").isArmadillo(void 0)?j.jsx(b("MWVerticalRhythm.bs").make,{height:5}):null,j.jsx(b("MWText.react"),{color:"positive",type:"body4",numberOfLines:1,children:g._(/*FBT_CALL*/"Ongoing call"/*FBT_CALL*/)})]}):null]})}a=a;f.styles=k;f.Timestamp=c;f.LockIcon=d;f.CometGlimmer=e;f.make=a}),null);
__d("MWUseLastMessageDeliveryStatusIcon.bs",["MWMessageDeliveryStatus.bs","MWMessageDeliveryStatusIcons.bs","ReQL.bs","ReQLSubscription.bs","bs_caml","bs_caml_int64","react","useReStore"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react");function a(a,c,d,e){var f=b("useReStore")(),g=b("ReQLSubscription.bs").useFirst(h.useMemo(function(){return b("ReQL.bs").getKeyRange(b("ReQL.bs").fromIndexDescending(f.table("messages").index("messageDisplayOrder")),{hd:a,tl:0})},[JSON.stringify(a)]));return h.useMemo(function(){if(g===void 0)return null;if(!b("bs_caml").i64_eq(g.senderId,e))return null;var a={contents:b("bs_caml_int64").zero},f={contents:b("bs_caml_int64").zero};d.forEach(function(c){if(b("bs_caml").i64_neq(c.contact_id,e)){a.contents=b("bs_caml").i64_gt(c.delivered_watermark_timestamp_ms,a.contents)?c.delivered_watermark_timestamp_ms:a.contents;f.contents=b("bs_caml").i64_gt(c.read_watermark_timestamp_ms,f.contents)?c.read_watermark_timestamp_ms:f.contents;return}});var i=b("bs_caml").i64_gt(c,f.contents);i=b("MWMessageDeliveryStatus.bs").deliveryStatusForMessageSentByYou(g,a.contents,i);if(typeof i!=="number")return null;switch(i){case 0:return null;case 1:return h.jsx(b("MWMessageDeliveryStatusIcons.bs").Sending.make,{size:2,xstyle:!1});case 2:return h.jsx(b("MWMessageDeliveryStatusIcons.bs").Sent.make,{size:2,xstyle:!1});case 3:return h.jsx(b("MWMessageDeliveryStatusIcons.bs").Delivered.make,{size:2,xstyle:!1});case 4:return h.jsx(b("MWMessageDeliveryStatusIcons.bs").$$Error.make,{size:2,xstyle:!1})}},[f,a,c,d,e,g])}f.useHook=a}),null);
__d("RTWebInboxJoinOngoingCallIcon.react",["ix","TetraIcon.react","fbicon","react","stylex"],(function(a,b,c,d,e,f,g,h){"use strict";var i=d("react"),j=function(a,b,c){if(b===!0)return k.camcorder[c];switch(a){case"AUDIO_GROUP_CALL":return k.phone[c];case"VIDEO_GROUP_CALL":return k.camcorder[c];default:return null}};function a(a){var b=a.hasActiveRoom,d=a.hidden,e=a.ongoingCallType;a=a.size;a=a===void 0?36:a;if(d)return null;d=j(e,b,a);return d===null?null:i.jsx("div",{className:c("stylex")(m.buttonContainer),children:i.jsx("div",{className:c("stylex")(m.button,l[a]),children:i.jsx(c("TetraIcon.react"),{color:"white",icon:d})})})}a.displayName=a.name+" [from "+f.id+"]";var k={camcorder:{32:d("fbicon")._(h("493173"),16),36:d("fbicon")._(h("493174"),20)},phone:{32:d("fbicon")._(h("558160"),16),36:d("fbicon")._(h("558161"),20)}},l={32:{height:"k7cz35w2",width:"bsnbvmp4"},36:{height:"tv7at329",width:"thwo4zme"}},m={button:{alignItems:"bp9cbjyn",backgroundImage:"h5vs1ck6",borderTopStartRadius:"s45kfl79",borderTopEndRadius:"emlxlaya",borderBottomEndRadius:"bkmhp75w",borderBottomStartRadius:"spb7xbtv",borderTopWidth:"rt8b4zig",borderEndWidth:"n8ej3o3l",borderBottomWidth:"agehan2d",borderStartWidth:"sk4xxmp2",boxSizing:"rq0escxv",display:"j83agx80",justifyContent:"taijpn5t",paddingTop:"jb3vyjys",paddingEnd:"rz4wbd8a",paddingBottom:"qt6c0cv9",paddingStart:"a8nywdso",position:"l9j0dhe7"},buttonContainer:{borderTopStartRadius:"s45kfl79",borderTopEndRadius:"emlxlaya",borderBottomEndRadius:"bkmhp75w",borderBottomStartRadius:"spb7xbtv",boxShadow:"akv41dx8",end:"rm21btxo",pointerEvents:"mrt03zmi",position:"pmk7jnqg",top:"rk01pc8j",transform:"ke6wolob"}};g["default"]=a}),98);
__d("MWThreadListItem.bs",["fbt","CometCardedDialogLoadingState.re","CometEntryPointDialogTrigger.react","CometListCellHoverButton.react","CometTextWithEntities.react","CometTransientDialogProvider.react","CommunityChatsActionEnum","CommunityMessagingEnableState.bs","FBGroupChatEventTypes","FBGroupChatInviteState.bs","FBGroupChatSourceTypes","FBID.bs","GroupsCometJoinChatDialog.entrypoint","InteractionTracingMetrics","LS.bs","LSMessagingThreadTypeUtil.bs","LSRtcCallState.bs","LSThreadTitle.bs","LSTransaction.bs","LSUpdateCommunityChannelDirectInvite","LsMessengerThreadDamagingActionsEntryPoint.bs","LsSystemFolder.bs","MDSListCell.react","MWCMGating.bs","MWCMThreadTypes.bs","MWCMUseFolder.bs","MWCMUseShouldGoToFullScreenChat.bs","MWChatCalculateIsMutedFromExpireTime.bs","MWChatTextTransform.bs","MWLSGetLearningSpaceRoomOnThread.bs","MWLSParticipant.bs","MWLSThreadDisplayContext.bs","MWLSThreadSnippetForDisplay","MWPActor.bs","MWPIsThreadUnread.bs","MWPThreadListItemInviteAddOn.react","MWSelectedThreadOptionsIdContext.bs","MWText.react","MWThreadAddOnSecondary.react","MWThreadListFocusableTable.react","MWThreadListLastMessage.bs","MWThreadPicture.bs","MWUseLastMessageDeliveryStatusIcon.bs","MWV2OpenTabOrThread.bs","MWV2PreloadThread.bs","MWVerticalRhythm.bs","MessageRequestsBulkActionsContext.react","MessageRequestsBulkActionsThreadListItem.bs","MessengerMuteUtils.bs","RTCCallState.bs","RTWebInboxJoinOngoingCallIcon.react","ReQL.bs","ReQLSubscription.bs","UseBlockedUserInterstitial.bs","bs_belt_Option","bs_caml","bs_caml_int64","bs_curry","bs_int64","cometPushToast","gkx","promiseDone","react","requireDeferred","stylex","useGroupsCometCMOffboardingEntryPointDialog","useMatchMedia","useMenuButtonVisibilityState","useReStore","useSimpleImpression"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||b("react");c={};d={};var k={listItemContainer:{paddingEnd:"dflh9lhu",paddingStart:"scb9dxdr",position:"l9j0dhe7"},listItemContainerForMessengerDotCom:{paddingEnd:"p8fzw8mz",paddingStart:"pcp91wgn"}},l=b("requireDeferred")("C4gEngagementFalcoEvent.bs").__setRef("MWThreadListItem.bs");function m(a,c,d,e){l.onReady(function(f){return b("bs_curry")._1(f.log,function(){return{action:b("CommunityChatsActionEnum").TAP,event:d,source:e,surface:b("FBGroupChatSourceTypes").CHAT_ROW,group_id:b("FBID.bs").ofString(c),thread_id:b("FBID.bs").ofString(a),parent_surface:"channel_list"}})})}var n=b("requireDeferred")("MWThreadListHoverButtonDropdownMenu.bs").__setRef("MWThreadListItem.bs");function a(a){var c=a.messagingEntrypoint,d=a.onClose,e=a.onThreadSelected,f=a.selected,h=a.thread,l=a.responsive,o=a.lsEntryPoint,p=a.renderThreadPhoto,q=a.renderThreadTitle;a=a.renderThreadSubtitle;var r=d!==void 0?d:function(a){},s=e!==void 0?e:function(a){},t=p!==void 0?p:function(a){return j.jsx(b("MWThreadPicture.bs").make,{photoSize:b("MWCMThreadTypes.bs").isAnyCMThread(a.threadType)||b("gkx")("571")?"s_48":"s_56",badgeSize:b("gkx")("571")?10:14,thread:a})},u=q!==void 0?q:function(a){return j.jsx(b("LSThreadTitle.bs").make,{thread:a})},v=a!==void 0?a:function(a){return j.jsx(b("MWThreadListLastMessage.bs").make,{hasOngoingCall:b("bs_caml").i64_neq(a.ongoingCallState,b("LSRtcCallState.bs").noOngoingCall),lastMessageTimestamp:b("bs_caml_int64").to_float(a.lastActivityTimestampMs),snippet:b("MWLSThreadSnippetForDisplay").MWLSThreadSnippetForDisplay(a),isUnread:b("MWPIsThreadUnread.bs").isThreadUnread(a),showTimestamp:!b("MWCMThreadTypes.bs").isUnjoinedCMThread(a.threadType),thread:a})};b("useSimpleImpression")(function(a){a=b("LSMessagingThreadTypeUtil.bs").isSecure(h.threadType);var c=b("InteractionTracingMetrics").currentInteractionLogger();return b("bs_curry")._2(c.addMetadata,"hasSecureThread",a?1:0)});d=b("LSMessagingThreadTypeUtil.bs").isSecure(h.threadType);var w=b("MWV2OpenTabOrThread.bs").useHook(void 0);e=j.useRef(null);p=j.useMemo(function(){return b("FBID.bs").ofStringExn(b("bs_int64").to_string(h.threadKey))},[h]);var x=b("useMatchMedia")("(min-width: 900px)")||!l,y=b("useReStore")();q=b("useGroupsCometCMOffboardingEntryPointDialog")(void 0);var z=q[0];a=b("ReQLSubscription.bs").useArray(j.useMemo(function(){return b("MWLSParticipant.bs").getAllInOpenThread(y,b("ReQL.bs").fromTableAscending(y.table("contacts")),h.threadKey)},[y,JSON.stringify(h.threadKey)]));l=b("MWLSGetLearningSpaceRoomOnThread.bs").useHook(h);q=l[2];l=b("MWPActor.bs").useActor(void 0);var A=b("MWPIsThreadUnread.bs").isThreadUnread(h),B=b("MWCMThreadTypes.bs").isUnjoinedCMThread(h.threadType),C=j.useMemo(function(){return b("MessengerMuteUtils.bs").calcMuteUntilMs(h)},[h]),D=h.snippetSenderContactId,E=D!==void 0?b("bs_caml").i64_eq(D,l):!1,F=b("MWChatCalculateIsMutedFromExpireTime.bs").useHook(C);D=b("useMenuButtonVisibilityState")(!0);var G=D[1],H=G.setMenuBtnFocused,I=G.setListItemHovered,J=b("MWCMThreadTypes.bs").isAnyCMThread(h.threadType),K=b("MWCMThreadTypes.bs").isBroadcastThread(h.threadType),L=b("bs_caml").i64_eq(h.parentThreadKey,b("LsSystemFolder.bs").inbox),M=L?x:!B,N=j.useCallback(function(a){return b("bs_curry")._1(I,!1)},[I]),O=j.useCallback(b("bs_curry").__1(H),[H]),P=j.useCallback(function(a){return b("bs_curry")._1(I,!0)},[I]),Q=K&&b("MWCMGating.bs").isBroadcastThreadEnabled?null:b("MWUseLastMessageDeliveryStatusIcon.bs").useHook(h.threadKey,h.lastActivityTimestampMs,a,l);K=b("MWV2PreloadThread.bs").useHook(h.threadKey,d);var R=K[1],S=K[0];a=b("bs_caml").i64_neq(h.ongoingCallState,b("LSRtcCallState.bs").noOngoingCall);var T=h.additionalThreadContext,U=j.useMemo(function(){if(T!==void 0)return j.jsxs(j.Fragment,{children:[j.jsx(b("MWText.react"),{color:"secondary",type:"meta4",numberOfLines:1,children:j.jsx(b("CometTextWithEntities.react"),{text:T,transforms:b("MWChatTextTransform.bs").epdTextTransforms}),testid:"eyebrowtext_message_request_v2"}),j.jsx(b("MWVerticalRhythm.bs").make,{height:8})]});else return null},[T]),V=b("MWCMUseFolder.bs").useHook(h);l=j.useMemo(function(){if(V!==void 0&&J)return[V.fbGroupId,V.enableState];else return[void 0,void 0]},[p]);var W=l[0],X=b("bs_caml").i64_eq(b("bs_belt_Option").getWithDefault(l[1],b("CommunityMessagingEnableState.bs").enabled),b("CommunityMessagingEnableState.bs").disableRequested),Y=h.folderName==="inbox"?b("LsMessengerThreadDamagingActionsEntryPoint.bs").inboxThreadList:h.folderName==="pending"?b("LsMessengerThreadDamagingActionsEntryPoint.bs").pendingThreadList:b("LsMessengerThreadDamagingActionsEntryPoint.bs").spamThreadList,aa=b("UseBlockedUserInterstitial.bs").useHook(h.threadKey),ba=function(a){b("bs_curry")._2(aa,function(c){c=a?w.openInbox:b("bs_curry")._1(w.openTabOrInbox,!0);return b("bs_curry")._2(c,{threadKey:h.threadKey,clientThreadKey:h.clientThreadKey,threadType:h.threadType},o)},Y);return b("bs_curry")._1(r,void 0)};K=b("MWLSThreadDisplayContext.bs").useHook(void 0);l=K!==void 0?K==="Inbox":!1;K=j.useContext(b("MessageRequestsBulkActionsContext.react"));K=K.isBulkActionsEditMode;var Z=b("MWCMUseShouldGoToFullScreenChat.bs").useHook(void 0),$=b("bs_belt_Option").getWithDefault(h.hasPendingInvitation,!1),ca=function(a){a=b("LSTransaction.bs").run(y,function(a){return b("LSUpdateCommunityChannelDirectInvite")(h.threadKey,b("FBGroupChatInviteState.bs").declinedByReceiver,b("LS.bs").make(a))},"readWrite");b("promiseDone")(a,void 0,void 0);m(b("bs_int64").to_string(h.threadKey),b("bs_int64").to_string(b("bs_belt_Option").getWithDefault(W,b("bs_caml_int64").zero)),b("FBGroupChatEventTypes").INVITE_DECLINED,b("FBGroupChatSourceTypes").DIRECT_INVITE_JOIN_BUTTON);b("cometPushToast").cometPushSimpleToast(g._(/*FBT_CALL*/"You declined the invitation to join"/*FBT_CALL*/).toString())};Z=j.jsx(b("CometEntryPointDialogTrigger.react"),{dialogEntryPoint:b("GroupsCometJoinChatDialog.entrypoint"),otherProps:{shouldGoToMessenger:Z,invited:$},preloadParams:{groupID:b("bs_int64").to_string(b("bs_belt_Option").getWithDefault(W,b("bs_caml_int64").zero)),threadID:b("bs_int64").to_string(h.threadKey)},fallback:function(a){return j.jsx(b("CometCardedDialogLoadingState.re").make,{})},children:function(a){var c,d=0;$?c=j.jsx(b("MWPThreadListItemInviteAddOn.react"),{onAccept:function(c){m(b("bs_int64").to_string(h.threadKey),b("bs_int64").to_string(b("bs_belt_Option").getWithDefault(W,b("bs_caml_int64").zero)),b("FBGroupChatEventTypes").INVITE_ACCEPTED,b("FBGroupChatSourceTypes").DIRECT_INVITE_DECLINE_BUTTON);return b("bs_curry")._1(a,void 0)},onDecline:ca}):x||!L?d=1:c=null;d===1&&(c=j.jsx(b("MWThreadAddOnSecondary.react"),{isUnread:A,isMuted:F,isViewerSender:E,lastMessageDeliveryStatusIcon:Q,thread:h}));return j.jsx(b("MDSListCell.react"),{addOnStart:b("bs_curry")._1(t,h),addOnEnd:c,content:x||!L?j.jsxs(j.Fragment,{children:[U,j.jsx(b("MWText.react"),{color:"primary",type:A?b("gkx")("571")?"entityHeaderMeta1":"headlineEmphasized4":b("gkx")("571")?"headline4":"body3",numberOfLines:1,children:b("bs_curry")._1(u,h)}),j.jsx(b("MWVerticalRhythm.bs").make,{height:8}),b("bs_curry")._1(v,h)]}):null,selected:f,size:"large",onHoverIn:S,onHoverOut:R,onFocusChange:O,onPress:function(c){if(B)if(X)return z({},function(a){});else return b("bs_curry")._1(a,void 0);c=c.metaKey||c.ctrlKey||c.shiftKey;ba(c);return b("bs_curry")._1(s,void 0)},linkProps:{preventLocalNavigation:!0,url:b("bs_curry")._1(w.getUrlFromThreadKey,h.threadKey)},"aria-current":f?"page":"false"})}},b("bs_int64").to_string(h.threadKey));if(M){if(K)M=null;else{D={hidden:!D[0],onFocusChange:H,onHoverChange:G.setMenuBtnHovered,onMenuStateChange:G.setMenuOpened,popoverResource:n,popoverProps:{fbid:p,isUnread:A,mutedUntil:C/1e3,onCloseJewel:r,messagingEntrypoint:c,thread:h,selected:f,groupId:b("bs_int64").to_string(b("bs_belt_Option").getWithDefault(W,b("bs_caml_int64").zero))},popoverTriggerType:"lazy",testid:"mwthreadlist-menu-id-"+p};H=b("gkx")("571")?32:void 0;H!==void 0&&(D.size=H);M=j.jsx(b("CometListCellHoverButton.react"),D)}G=j.jsx(b("MWThreadListFocusableTable.react").MWThreadListFocusableTableCell,{children:j.jsxs("div",{role:"gridcell",children:[j.jsx(b("RTWebInboxJoinOngoingCallIcon.react"),{hasActiveRoom:q,hidden:!a&&!q,ongoingCallType:b("RTCCallState.bs").ofLsRtcCallState(h.ongoingCallState,h.threadType),size:32}),M]})})}else G=null;C=j.jsx("div",{"data-testid":d?"mwthreadlist-item-secure":"mwthreadlist-item-open",children:j.jsx("div",{className:(i||(i=b("stylex")))(k.listItemContainer,b("gkx")("571")?k.listItemContainerForMessengerDotCom:!1),onMouseEnter:P,onMouseLeave:N,role:"row","data-testid":"mwthreadlist-item",children:j.jsxs(b("MWThreadListFocusableTable.react").MWThreadListFocusableTableRow,{children:[j.jsx(b("MWThreadListFocusableTable.react").MWThreadListFocusableTableCell,{children:j.jsx("div",{role:"gridcell",ref:e,children:K?j.jsx(b("MessageRequestsBulkActionsThreadListItem.bs").make,{thread:h,threadListCell:Z}):Z})}),G]})})});if(l)return j.jsx(b("MWSelectedThreadOptionsIdContext.bs").make,{children:j.jsx(b("CometTransientDialogProvider.react"),{children:C}),threadId:h.threadKey});else return C}e=j.memo(a);f.RTWebInboxJoinOngoingCallIcon=c;f.MWPThreadListItemInviteAddOn=d;f.styles=k;f.$C4gEngagementFalcoEvent$Deferred=l;f.logInviteAcceptOrDecline=m;f.$MWThreadListHoverButtonDropdownMenu$Deferred=n;f.make=e}),null);
__d("MWThreadListFolderItem.bs",["CometTextWithEntities.react","MWCMThreadTypes.bs","MWChatTextTransform.bs","MWPIsThreadUnread.bs","MWText.react","MWThreadListFocusableTable.react","MWThreadListLastMessage.bs","ReQL.bs","ReQLSubscription.bs","SortedAsyncIterable.bs","TetraListCell.react","bs_belt_Option","bs_caml","bs_caml_int64","bs_caml_option","bs_curry","react","useMatchMedia","useReStore"],(function(a,b,c,d,e,f){"use strict";var g,h=g||b("react");function a(a){var c=a.size,d=a.thread,e=a.responsive,f=a.onClick,g=a.selectedThreadKey,i=a.systemFolder,j=a.icon,k=a.threadName;a=b("useMatchMedia")("(min-width: 900px)")||!e;var l=b("useReStore")();e=b("bs_belt_Option").isSome(b("ReQLSubscription.bs").useFirst(h.useMemo(function(){if(g!==void 0)return b("ReQL.bs").filter(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(l.table("threads")),{hd:g,tl:0}),function(a){return b("bs_caml").i64_eq(a.parentThreadKey,i)});else return b("SortedAsyncIterable.bs").empty(void 0)},[g,d])));var m=h.useMemo(function(){var a=d.snippet;if(a!==void 0)return a;else return null},[d]),n=b("bs_caml_int64").to_float(d.lastActivityTimestampMs),o=b("MWPIsThreadUnread.bs").isThreadUnread(d),p=d.threadName;c=h.useMemo(function(){return j},[c]);var q=h.useMemo(function(){return b("bs_belt_Option").getWithDefault(p,k)},[p]),r=h.useMemo(function(){return h.jsx(b("MWText.react"),{color:"primary",type:o?"headlineEmphasized4":"body3",numberOfLines:1,children:h.jsx(b("CometTextWithEntities.react"),{text:q.toString(),transforms:b("MWChatTextTransform.bs").epdTextTransforms})})},[o,q]),s=h.useCallback(function(a){return b("bs_curry")._1(f,void 0)},[f]);n={body:a?h.jsx(b("MWThreadListLastMessage.bs").make,{hasOngoingCall:!1,lastMessageTimestamp:n,snippet:m,isUnread:o,showTimestamp:!b("MWCMThreadTypes.bs").isUnjoinedCMThread(d.threadType)}):null,addOnPrimary:c,bodyLineLimit:1,emphasized:o,headlineLineLimit:1,level:4,onPress:s,selected:e};m=a?b("bs_caml_option").some(r):void 0;m!==void 0&&(n.headline=b("bs_caml_option").valFromOption(m));c=h.jsx(b("MWThreadListFocusableTable.react").MWThreadListFocusableTableRow,{children:h.jsx("div",{role:"row",children:h.jsx(b("MWThreadListFocusableTable.react").MWThreadListFocusableTableCell,{children:h.jsx("div",{role:"gridcell",children:h.jsx(b("TetraListCell.react"),n)})})})});s={children:c};return h.jsx("div",(s["data-testid"]="mwthreadlist-item",s))}c=a;f.make=c}),null);
__d("MWThreadListJobsItem.bs",["fbt","ix","LsSystemFolder.bs","MWThreadListFolderItem.bs","bs_curry","fbicon","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react");function a(a){var c=a.size,d=a.thread,e=a.responsive,f=a.onClick;a=a.selectedThreadKey;var i=function(a){return b("bs_curry")._1(f,b("LsSystemFolder.bs").jobs)};return j.jsx(b("MWThreadListFolderItem.bs").make,{size:c,thread:d,responsive:e,onClick:i,selectedThreadKey:a,systemFolder:b("LsSystemFolder.bs").jobs,icon:{color:"gray",size:56,disabled:!1,shape:"circle",icon:b("fbicon")._(h("512668"),32),type:"contained-icon"},threadName:g._(/*FBT_CALL*/"Jobs"/*FBT_CALL*/)})}c=a;f.make=c}),null);
__d("MWThreadList.bs",["fbt","CometPlaceholder.react","FBID.bs","FocusRegion.react","LSMessagingThreadTypeUtil.bs","LsSystemFolder.bs","MWIsXacGroupThread.bs","MWLSJewelMessageRequestsThread.bs","MWPBaseThreadList.bs","MWPBumpEntityKey.bs","MWPThreadIsPage.bs","MWPThreadsForThreadList.bs","MWText.react","MWThreadKey.bs","MWThreadListGlimmer.react","MWThreadListItem.bs","MWThreadListJobsItem.bs","MWThreadListSupportedThreadTypes.bs","MWThread_DEPRECATED.bs","MWXacGating.bs","MessagingThreadType.bs","MessengerWebEntryPoint","ReQL.bs","ReQLSuspense","bs_belt_Option","bs_caml","bs_caml_obj","bs_caml_option","bs_curry","bs_int64","cr:12211","cr:1913","cr:9873","react","recoverableViolation","stylex","useCometUniqueID","useReStore","useSimpleImpression"],(function(a,b,c,d,e,f,g){"use strict";var h,i,j=h||b("react"),k=b("cr:1913")==null?void 0:b("bs_caml_option").some(b("cr:1913"));e=b("cr:12211")==null?void 0:b("bs_caml_option").some(b("cr:12211"));function a(a){b("useSimpleImpression")(a)}var l={container:{flexGrow:"buofh1pr",flexDirection:"cbu4d94t",overflowX:"ni8dbmo4",overflowY:"stjgntxs",display:"j83agx80"},emptyInbox:{paddingTop:"discj3wi",paddingEnd:"hv4rvrfc",paddingBottom:"ihqw7lf3",paddingStart:"dati1w0a"}};function m(a){j.useEffect(function(){b("recoverableViolation")("Unknown thread type","comet_messenger")},[]);return null}var n={make:m};function o(a){var c=b("FBID.bs").ofStringExn(b("bs_int64").to_string(a.threadKey)),d=a.threadType;a=a.cannotUnsendReason;if(a!==void 0&&b("bs_caml").i64_eq(d,b("MessagingThreadType.bs").oneToOne)&&b("bs_caml").i64_eq(a,[0,4]))return{NAME:"Page",VAL:c};if(b("LSMessagingThreadTypeUtil.bs").isOneToOne(d))return{NAME:"User",VAL:c};else if(b("LSMessagingThreadTypeUtil.bs").isGroup(d))return{NAME:"Group",VAL:c};else return}function c(a){var c=a.thread,d=a.messagingEntrypoint,e=a.lsEntryPoint,f=a.onClose,g=a.responsive,h=a.onClickNestedFolderThread;a=a.selectedThreadKey;if(b("bs_caml").i64_eq(c.threadType,b("MessagingThreadType.bs").folder)){var i=c.threadKey;if(b("bs_caml").i64_eq(i,b("LsSystemFolder.bs").mplace))if(b("cr:1913")==null)return null;else return j.jsx(k.make,{size:56,thread:c,responsive:g,onClick:h,selectedThreadKey:a});else if(b("bs_caml").i64_eq(i,b("LsSystemFolder.bs").jobs))return j.jsx(b("MWThreadListJobsItem.bs").make,{size:56,thread:c,responsive:g,onClick:h,selectedThreadKey:a});else return null}i=o(c);if(i!==void 0)return j.jsx(b("MWThread_DEPRECATED.bs").make,{id:i,children:j.jsx(b("CometPlaceholder.react"),{children:j.jsx(b("MWPThreadIsPage.bs").make,{threadKey:c.threadKey,children:j.jsx(b("MWThreadKey.bs").make,{id:c.threadKey,children:j.jsx(b("MWThreadListItem.bs").make,{messagingEntrypoint:d,onClose:f,selected:b("bs_caml_obj").caml_equal(a,c.threadKey),size:56,thread:c,responsive:g,lsEntryPoint:e})})}),fallback:j.jsx(b("MWThreadListGlimmer.react"),{})})});else return j.jsx(m,{})}var p=j.memo(c);c={make:p};var q=b("cr:12211")==null?function(a){}:e.useHook;function d(a){var c=a.parentThreadKey,d=a.header,e=a.onOpenMessageRequests,f=a.threadListMessagingEntrypoint,h=a.selectedThreadKey,k=a.onClose,m=a.responsive,n=a.preamble,o=a.lsEntryPoint,r=a.onClickNestedFolderThread,s=a.gridLabel,t=a.setHasScrolled,u=k!==void 0?k:function(a){};a=n!==void 0?b("bs_caml_option").valFromOption(n):null;var v=r!==void 0?r:function(a){},w=b("useReStore")(),x=b("ReQLSuspense").useFirst(function(){return b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(w.table("threads_ranges_v2__generated")),{hd:c,tl:0})},[w,c]);k=b("ReQLSuspense").useArray(function(){return b("ReQL.bs").take(b("ReQL.bs").filter(b("ReQL.bs").filter(b("MWPThreadsForThreadList.bs").createIterable(w,c,x),function(a){return b("MWThreadListSupportedThreadTypes.bs").supportedThreadTypes.findIndex(function(c){return b("bs_caml").i64_eq(a.threadType,c)})!==-1}),function(a){if(b("MWXacGating.bs").isGroupsEnabled(void 0))return!0;else return!b("MWIsXacGroupThread.bs").check(a)}),5)},[w,JSON.stringify(c),x]).pop();var y=k===void 0?void 0:b("bs_caml_option").some(k);n=d!==void 0?j.jsx(b("FocusRegion.react").FocusRegion,{children:b("bs_caml_option").valFromOption(d)}):null;r=b("useCometUniqueID")();b("bs_curry")._1(q,r);k=b("MWLSJewelMessageRequestsThread.bs").useHook(e);var z=j.useCallback(function(a){if(t!==void 0)return b("bs_curry")._1(t,function(b){return a.target.scrollTop!==0})},[]);d=j.useCallback(function(a){return j.jsx(p,{thread:a,messagingEntrypoint:b("bs_belt_Option").getWithDefault(f,b("MessengerWebEntryPoint").JEWEL),lsEntryPoint:o==="inboxThreadList"?b("bs_belt_Option").mapWithDefault(y,!1,function(c){return b("bs_caml").i64_le(a.lastActivityTimestampMs,c.lastActivityTimestampMs)})?"inboxRecentThreads":"inboxRemainingThreads":o,onClose:u,responsive:m,onClickNestedFolderThread:v,selectedThreadKey:h})},[m,f,o,u,v,h,y]);e=j.useRef(null);var A=e.current;j.useEffect(function(){A==null||A.addEventListener("scroll",z)},[A]);return j.jsx("div",{id:r,className:(i||(i=b("stylex")))(l.container),children:j.jsx(b("MWPBaseThreadList.bs").make,{beforeContent:j.jsxs(j.Fragment,{children:[n,k,a]}),gridLabel:s,renderItem:d,itemPlaceholder:j.jsxs(j.Fragment,{children:[j.jsx(b("MWThreadListGlimmer.react"),{}),j.jsx(b("MWThreadListGlimmer.react"),{})]}),emptyContent:j.jsx("div",{className:i(l.emptyInbox),children:j.jsx(b("MWText.react"),{align:"center",type:"body2",children:g._(/*FBT_CALL*/"No messages found."/*FBT_CALL*/)})}),onLoadMoreThreads:function(a){return b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("mw.threadlist","load_more_threads")},parentThreadKey:c,scrollAreaElementRef:e,renderLoadingAnimation:function(a){return j.jsxs(j.Fragment,{children:[j.jsx(b("MWThreadListGlimmer.react"),{}),j.jsx(b("MWThreadListGlimmer.react"),{})]})}})})}e=56;d=d;f.$MAWThreadId$requireCond=b("cr:9873");f.$MWUseKeyCommandsForThreadList$OR$null$requireCond=b("cr:12211");f.$null$OR$MWThreadListMarketplaceItem$requireCond=b("cr:1913");f.useSimpleImpression=a;f.threadlistItemHeight=e;f.styles=l;f.UnknownThreadType=n;f.ThreadListItemMemoized=c;f.useKeyCommandsForThreadList=q;f.make=d}),null);
__d("MWThreadListMarketplaceItem.bs",["fbt","ix","LsSystemFolder.bs","MWPBumpEntityKey.bs","MWThreadListFolderItem.bs","bs_curry","fbicon","react"],(function(a,b,c,d,e,f,g,h){"use strict";var i,j=i||b("react");function a(a){var c=a.size,d=a.thread,e=a.responsive,f=a.onClick;a=a.selectedThreadKey;return j.jsx(b("MWThreadListFolderItem.bs").make,{size:c,thread:d,responsive:e,onClick:function(a){b("bs_curry")._1(f,b("LsSystemFolder.bs").mplace);return b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("mw.sidebar","marketplace_threads")},selectedThreadKey:a,systemFolder:b("LsSystemFolder.bs").mplace,icon:{color:"gray",size:56,disabled:!1,shape:"circle",icon:b("fbicon")._(h("1027308"),32),type:"contained-icon"},threadName:g._(/*FBT_CALL*/"Marketplace"/*FBT_CALL*/)})}c=a;f.make=c}),null);
__d("LSDataTraceFlushDeferred.bs",["bs_curry","killswitch","requireDeferred"],(function(a,b,c,d,e,f){"use strict";var g=b("requireDeferred")("LSDataTraceFlush.bs").__setRef("LSDataTraceFlushDeferred.bs");function a(a){if(!b("killswitch")("MESSENGER_WEB_DATA_TRACE_ID")){g.onReady(function(c){return b("bs_curry")._1(c.flushExpiredDataTraces,a)});return}}f.$LSDataTraceFlush$Deferred=g;f.watchForExpiredTraces=a}),null);
__d("LSClearEpochBeforeResumeSync.bs",["LSTransaction.bs","Promise","ReQL.bs","bs_caml","bs_caml_int64","gkx","killswitch"],(function(a,b,c,d,e,f){"use strict";function a(a){if(!b("killswitch")("MESSENGER_WEB_PERSISTED_DB")&&b("gkx")("3174"))return b("LSTransaction.bs").run(a,function(a){var c;return(c=b("ReQL.bs")).toArray(c.mergeJoin(c.fromTableAscending(a.table("sync_groups")),c.getKeyRange(c.fromTableAscending(a.table("network_requests")),{hd:"",tl:0}))).then(function(c){return b("Promise").all(c.map(function(c){var d=c[0];if(!(d.currentCursor!==void 0||b("bs_caml").i64_eq(d.syncStatus,b("bs_caml_int64").zero)))return b("Promise").resolve(void 0);d=c[1];return a.table("network_requests").put({taskQueueName:d.taskQueueName,syncDatabaseId:d.syncDatabaseId,epochId:void 0,networkTaskIdentifier:d.networkTaskIdentifier,lastSentTimestampMs:d.lastSentTimestampMs,failureCount:d.failureCount,lastSyncRequestTimestampMs:d.lastSyncRequestTimestampMs,lastDelayedRequestTimestampMs:d.lastDelayedRequestTimestampMs})}))}).then(function(c){return b("ReQL.bs").toArray(b("ReQL.bs").filter(b("ReQL.bs").fromTableAscending(a.table("network_requests")),function(a){return a.taskQueueName!==""})).then(function(c){return b("Promise").all(c.map(function(b){return a.table("network_requests").put({taskQueueName:b.taskQueueName,syncDatabaseId:b.syncDatabaseId,epochId:void 0,networkTaskIdentifier:b.networkTaskIdentifier,lastSentTimestampMs:b.lastSentTimestampMs,failureCount:b.failureCount,lastSyncRequestTimestampMs:b.lastSyncRequestTimestampMs,lastDelayedRequestTimestampMs:b.lastDelayedRequestTimestampMs})}))})})},"readWrite").then(function(a){return b("Promise").resolve(void 0)});else return b("Promise").resolve(void 0)}f.call=a}),null);
__d("LSPlatformGraphQLTransport.bs",["FBLogger","LSDynamicDependencies","LSLogHistory","Promise","Promise.bs","bs_belt_Option","bs_caml_exceptions","bs_caml_int64","bs_caml_option","bs_int64"],(function(a,b,c,d,e,f){"use strict";var g=b("bs_caml_exceptions").create("LSPlatformGraphQLTransport.ServerError");function a(a,c,d,e,f){return b("Promise.bs").$$catch(f(a,c,e,b("bs_caml_int64").to_int32(d)),function(a){if(a.RE_EXN_ID===b("Promise.bs").JsError){a=a._1;var c=a.message;b("LSLogHistory").log("Error sending Graphql Request. Type: "+b("bs_int64").to_string(d)+" Message: "+(c!==void 0?c:"None"),"error");b("FBLogger")("messenger_web_product").catching(a).debug("Relay or Graphql Server error in LSPlatformGraphqlTransport")}throw{RE_EXN_ID:g,Error:new Error()}}).then(function(c){c=b("bs_belt_Option").getExn(c==null?void 0:b("bs_caml_option").some(c));var a=b("bs_belt_Option").getExn(b("bs_caml_option").nullable_to_opt(c.payload)),d=c.dependencies;d=d==null?b("Promise").resolve(void 0):b("LSDynamicDependencies").downloadRelayDependencies(d);return[d,a,b("bs_caml_option").nullable_to_opt(c.experiments)]})}f.ServerError=g;f.publish=a}),null);
__d("LSPlatformHardcodedInitSync.bs",["CurrentUser","IntlCurrentLocale","LSDatabaseType.bs","LSDict","LSJson","LSPlatformGraphQLTransport.bs","LSRequestType.bs","LSTransaction.bs","MAWGating.bs","MWPBumpEntityKey.bs","Promise","Promise.bs","QPLUserFlow","QuickPerformanceLogger","ReQL.bs","bs_belt_Option","bs_caml_format","bs_caml_int64","bs_caml_option","bs_curry","gkx","qpl","recoverableViolation"],(function(a,b,c,d,e,f){"use strict";var g=b("bs_caml_int64").zero,h=b("MAWGating.bs").isArmadillo(void 0)&&b("MAWGating.bs").isOccamadillo(void 0);function i(a){return b("LSTransaction.bs").run(a,function(a){var c;return b("Promise").all([a.table("network_requests").put({taskQueueName:"",syncDatabaseId:b("LSDatabaseType.bs").mailbox,epochId:void 0,networkTaskIdentifier:void 0,lastSentTimestampMs:(c=b("bs_caml_int64")).zero,failureCount:c.zero,lastSyncRequestTimestampMs:c.zero,lastDelayedRequestTimestampMs:void 0}),a.table("network_requests").put({taskQueueName:"",syncDatabaseId:b("LSDatabaseType.bs").contact,epochId:void 0,networkTaskIdentifier:void 0,lastSentTimestampMs:c.zero,failureCount:c.zero,lastSyncRequestTimestampMs:c.zero,lastDelayedRequestTimestampMs:void 0}),h?a.table("network_requests").put({taskQueueName:"",syncDatabaseId:b("LSDatabaseType.bs").e2eeMessagingMetadataMailbox,epochId:void 0,networkTaskIdentifier:void 0,lastSentTimestampMs:b("bs_caml_int64").zero,failureCount:b("bs_caml_int64").zero,lastSyncRequestTimestampMs:b("bs_caml_int64").zero,lastDelayedRequestTimestampMs:void 0}):b("Promise").resolve(void 0)])},"readWrite").then(function(a){return b("Promise").resolve(void 0)})}function j(a){return b("LSTransaction.bs").run(a,function(a){var c;return b("Promise").all([(c=b("ReQL.bs")).first(c.getKeyRange(c.fromTableAscending(a.table("network_requests")),{hd:"",tl:{hd:b("LSDatabaseType.bs").mailbox,tl:0}})),c.first(c.getKeyRange(c.fromTableAscending(a.table("network_requests")),{hd:"",tl:{hd:b("LSDatabaseType.bs").contact,tl:0}})),h?b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(a.table("network_requests")),{hd:"",tl:{hd:b("LSDatabaseType.bs").e2eeMessagingMetadataMailbox,tl:0}})):b("Promise").resolve(void 0)]).then(function(c){var d=c[2],e=c[1];c=c[0];c=c!==void 0&&e!==void 0?b("Promise").all([a.table("network_requests").put({taskQueueName:c.taskQueueName,syncDatabaseId:c.syncDatabaseId,epochId:g,networkTaskIdentifier:c.networkTaskIdentifier,lastSentTimestampMs:c.lastSentTimestampMs,failureCount:c.failureCount,lastSyncRequestTimestampMs:c.lastSyncRequestTimestampMs,lastDelayedRequestTimestampMs:c.lastDelayedRequestTimestampMs}),a.table("network_requests").put({taskQueueName:e.taskQueueName,syncDatabaseId:e.syncDatabaseId,epochId:g,networkTaskIdentifier:e.networkTaskIdentifier,lastSentTimestampMs:e.lastSentTimestampMs,failureCount:e.failureCount,lastSyncRequestTimestampMs:e.lastSyncRequestTimestampMs,lastDelayedRequestTimestampMs:e.lastDelayedRequestTimestampMs})]).then(function(a){}):b("Promise").resolve(void 0);e=h&&d!==void 0?a.table("network_requests").put({taskQueueName:d.taskQueueName,syncDatabaseId:d.syncDatabaseId,epochId:g,networkTaskIdentifier:d.networkTaskIdentifier,lastSentTimestampMs:d.lastSentTimestampMs,failureCount:d.failureCount,lastSyncRequestTimestampMs:d.lastSyncRequestTimestampMs,lastDelayedRequestTimestampMs:d.lastDelayedRequestTimestampMs}):b("Promise").resolve(void 0);return b("Promise").all([c,e]).then(function(a){})})},"readWrite")}function a(a,c,d){b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("mw_graphql","init_sync.success");b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("mw_ls","init_sync.success");var e={scale:1,preview_height:200,preview_width:a.previewWidth,preview_height_large:400,preview_width_large:a.previewWidthLarge,full_height:200,snapshot_num_threads_per_page:a.numThreads,locale:b("IntlCurrentLocale").code,snapshot_num_messages:b("gkx")("1355")?1:void 0},f=b("CurrentUser").isWorkUser();return j(d).then(function(j){return b("Promise.bs").$$catch(b("Promise").all([(j=b("ReQL.bs")).first(j.getKeyRange(j.fromTableAscending(d.table("sync_groups")),{hd:b("LSDatabaseType.bs").mailbox,tl:0})),j.first(j.getKeyRange(j.fromTableAscending(d.table("sync_groups")),{hd:b("LSDatabaseType.bs").contact,tl:0})),h?b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(d.table("sync_groups")),{hd:b("LSDatabaseType.bs").e2eeMessagingMetadataMailbox,tl:0})):b("Promise").resolve(void 0)]).then(function(c){var d,i=(d=b("bs_belt_Option")).mapWithDefault(c[0],void 0,function(a){return a.currentCursor}),j=d.mapWithDefault(c[1],void 0,function(a){return a.currentCursor});c=d.mapWithDefault(c[2],void 0,function(a){return a.currentCursor});var k=new(b("LSDict"))().set("database",b("LSDatabaseType.bs").mailbox).set("version",b("bs_caml_format").caml_int64_of_string(a.schemaVersion)).set("sync_params",d.getExn(JSON.stringify(e))).set("epoch_id",g).set("last_applied_cursor",i),l=new(b("LSDict"))().set("database",b("LSDatabaseType.bs").contact).set("version",b("bs_caml_format").caml_int64_of_string(a.schemaVersion)).set("sync_params",d.getExn(JSON.stringify({locale:b("IntlCurrentLocale").code}))).set("epoch_id",g).set("last_applied_cursor",j);d=new(b("LSDict"))().set("database",b("LSDatabaseType.bs").e2eeMessagingMetadataMailbox).set("version",b("bs_caml_format").caml_int64_of_string(a.schemaVersion)).set("sync_params",d.getExn(JSON.stringify(e))).set("epoch_id",g).set("last_applied_cursor",c);f&&(b("QuickPerformanceLogger").markerPoint(b("qpl")._(1036588047,"310"),"start_mailbox"),b("QuickPerformanceLogger").markerPoint(b("qpl")._(1036588047,"310"),"start_contact"));return b("Promise").all([b("LSPlatformGraphQLTransport.bs").publish(a.deviceId,0,b("bs_belt_Option").isSome(i)?b("LSRequestType.bs").resumeSync:b("LSRequestType.bs").initSync,b("LSJson").stringify(k),a.executeGraphQLLightSpeedRequest).then(function(a){f&&b("QuickPerformanceLogger").markerPoint(b("qpl")._(1036588047,"310"),"mailbox_synced");return b("Promise").resolve([a[0],a[1],a[2]])}),b("LSPlatformGraphQLTransport.bs").publish(a.deviceId,1,b("bs_belt_Option").isSome(j)?b("LSRequestType.bs").resumeSync:b("LSRequestType.bs").initSync,b("LSJson").stringify(l),a.executeGraphQLLightSpeedRequest).then(function(a){f&&b("QuickPerformanceLogger").markerPoint(b("qpl")._(1036588047,"310"),"contact_synced");return b("Promise").resolve([a[0],a[1],a[2]])}),h?b("LSPlatformGraphQLTransport.bs").publish(a.deviceId,0,b("bs_belt_Option").isSome(c)?b("LSRequestType.bs").resumeSync:b("LSRequestType.bs").initSync,b("LSJson").stringify(d),a.executeGraphQLLightSpeedRequest):b("Promise").resolve([b("Promise").resolve(void 0),"",void 0])])}).then(function(a){var d=a[2],e=d[2],f=d[1],g=a[1],i=g[2],j=g[1];a=a[0];var k=a[2],l=a[1];b("QPLUserFlow").addPoint(b("qpl")._(25305590,"1127"),"gql_payload_received",void 0);h&&b("QPLUserFlow").addPoint(b("qpl")._(25310776,"6155"),"gql_payload_received",void 0);return b("Promise").all([a[0],g[0],d[0]]).then(function(a){b("QPLUserFlow").addPoint(b("qpl")._(25305590,"1127"),"gql_deps_downloaded",void 0);h&&b("QPLUserFlow").addPoint(b("qpl")._(25310776,"6155"),"gql_deps_downloaded",void 0);return b("bs_curry")._1(c,{experiments:k,syncScript:l})}).then(function(a){return b("bs_curry")._1(c,{experiments:i,syncScript:j})}).then(function(a){if(h)return b("bs_curry")._1(c,{experiments:e,syncScript:f});else return b("Promise").resolve(void 0)})}).then(function(a){f&&b("QuickPerformanceLogger").markerPoint(b("qpl")._(1036588047,"310"),"sync_completed"),b("QPLUserFlow").addPoint(b("qpl")._(25305590,"1127"),"success_with_init_sync",void 0),h&&b("QPLUserFlow").addPoint(b("qpl")._(25310776,"6155"),"success_with_init_sync",void 0)}),function(a){b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("mw_ls","init_sync.fail");f&&b("QuickPerformanceLogger").markerPoint(b("qpl")._(1036588047,"310"),"sync_failed");b("QPLUserFlow").endFailure(b("qpl")._(25305590,"1127"),"failure_during_init_sync",void 0);h&&b("QPLUserFlow").endFailure(b("qpl")._(25310776,"6155"),"failure_during_init_sync",void 0);a.RE_EXN_ID===b("LSPlatformGraphQLTransport.bs").ServerError||a.RE_EXN_ID!==b("Promise.bs").JsError||b("recoverableViolation")("Encountered an error while performining preloaded init sync request via graphql","messenger_web_product",{error:b("bs_caml_option").some(a._1)});return i(d)})})}c={taskQueueName:"",syncDatabaseId:b("bs_caml_int64").zero,epochId:void 0,networkTaskIdentifier:void 0,lastSentTimestampMs:b("bs_caml_int64").zero,failureCount:b("bs_caml_int64").zero,lastSyncRequestTimestampMs:b("bs_caml_int64").zero,lastDelayedRequestTimestampMs:void 0};f.defaultNetworkRequest=c;f.initialEpochId=g;f.isArmadilloAndOccamadillo=h;f.handlePreloadedSyncFailure=i;f.setEpochId=j;f.sendHardcodedInitSync=a}),null);
__d("LSPlatformRequestId",[],(function(a,b,c,d,e,f){"use strict";var g=2;function a(){var a=g;g+=1;return a}b={generate:a};f["default"]=b}),66);
__d("LSPlatformRequestScheduler",["clearTimeout","setTimeout"],(function(a,b,c,d,e,f,g){"use strict";a=function(){function a(){this.requests=new Map()}var b=a.prototype;b.schedule=function(a,b,d){var e=this.requests.get(b);e!=null&&c("clearTimeout")(e);this.requests.set(b,c("setTimeout")(a,d))};return a}();g["default"]=a}),98);
__d("LSPlatformServerResponseHandler",["Promise","regeneratorRuntime"],(function(a,b,c,d,e,f){"use strict";a=function(){function a(a){this.eval=a,this.currentlyRunning=b("Promise").resolve()}var c=a.prototype;c.evalWhenReady=function(a,c){return b("regeneratorRuntime").async(function(d){while(1)switch(d.prev=d.next){case 0:d.next=2;return b("regeneratorRuntime").awrap(a);case 2:d.next=4;return b("regeneratorRuntime").awrap(this.eval(c));case 4:case"end":return d.stop()}},null,this)};c.evalInOrderReceived=function(a,b){var c=this,d=this.currentlyRunning.then(function(){return c.evalWhenReady(a,babelHelpers["extends"]({},b,{priority:"ui"}))});this.currentlyRunning=d;return d};return a}();f["default"]=a}),66);
__d("LSTaskWorkItemType.bs",["bs_caml_int64"],(function(a,b,c,d,e,f){"use strict";a=b("bs_caml_int64").one;c=[0,2];d=[0,3];e=[0,4];b=[0,5];f.workItemTypeSendToServer=a;f.workItemTypeHandleNative=c;f.workItemTypeDelayHandling=d;f.workItemTypeNone=e;f.workItemTypeSendToServerFireAndForget=b}),null);
__d("LSPlatformSyncSystem.bs",["LS.bs","LSBeginHandlingSync","LSBeginHandlingSyncForSyncGroup","LSCookie.bs","LSDict","LSJson","LSLogHistory","LSPersistedDbGating","LSPlatformGraphQLTransport.bs","LSPlatformRealtimeTransport.bs","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSSyncChannel.bs","LSTaskWorkItemType.bs","LSTransaction.bs","MWPBumpEntityKey.bs","Promise","Promise.bs","ReQL.bs","SortedAsyncIterable.bs","bs_belt_Option","bs_caml","bs_caml_format","bs_caml_int64","bs_caml_obj","bs_caml_option","bs_curry","bs_int64","bs_js_dict","gkx","killswitch","promiseDone","recoverableViolation"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d,e,f,g){var h=new(b("LSPlatformServerResponseHandler"))(d),i=function(a,c){return b("LSTransaction.bs").run(a,function(a){return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(a.table("network_requests")),{hd:"",tl:{hd:c,tl:0}})).then(function(c){if(c!==void 0)return a.table("network_requests").put({taskQueueName:c.taskQueueName,syncDatabaseId:c.syncDatabaseId,epochId:void 0,networkTaskIdentifier:c.networkTaskIdentifier,lastSentTimestampMs:c.lastSentTimestampMs,failureCount:b("bs_caml_int64").add(c.failureCount,b("bs_caml_int64").one),lastSyncRequestTimestampMs:c.lastSyncRequestTimestampMs,lastDelayedRequestTimestampMs:c.lastDelayedRequestTimestampMs});else return b("Promise").resolve(void 0)})},"readWrite")},j=new(b("LSPlatformRequestScheduler"))(),k=function(a,h,i){i=b("LSDict").shapeToRecord(i);var j=b("LSDict").shapeToRecord(i.request_payload),k=i.type,l=b("LSPlatformRequestId").generate(),m=b("LSJson").stringify(b("LSDict").fromObject({database:j.database,version:b("bs_caml_format").caml_int64_of_string(e),epoch_id:j.epoch_id,last_applied_cursor:j.last_applied_cursor,failure_count:j.failure_count,sync_params:j.sync_params}));if(h.skip_realtime_gateway)return b("LSPlatformGraphQLTransport.bs").publish(f,l,k,m,g).then(function(a){return b("bs_curry")._1(d,{experiments:a[2],syncScript:a[1]}).then(function(a){return b("Promise").resolve(void 0)})});else return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(a.table("sync_groups")),{hd:h.sync_group_id,tl:0})).then(function(a){a=a!==void 0?a.syncChannel:b("LSSyncChannel.bs").mqtt;return b("bs_curry")._5(c.publish,a,void 0,l,k,m).then(function(a){return b("Promise").resolve(void 0)})})},l=function a(c,d){var e=function(d){return b("LSTransaction.bs").run(c,function(a){return b("LSBeginHandlingSyncForSyncGroup")(d,!1,b("LS.bs").make(a))},"readWrite").then(function(b){return a(c,b[0])})},f=function(a,c){j.schedule(function(){b("promiseDone")(e(a),void 0,void 0)},b("bs_int64").to_string(a),b("bs_caml_int64").to_float(c))},g=b("LSDict").shapeToRecord(d);d=g.work_item_type;if(b("bs_caml").i64_eq(d,b("LSTaskWorkItemType.bs").workItemTypeSendToServer)||b("bs_caml").i64_eq(d,b("LSTaskWorkItemType.bs").workItemTypeSendToServerFireAndForget)){var h=g.network_payload;if(h!==void 0)return b("Promise.bs").$$catch(k(c,g,b("bs_caml_option").valFromOption(h)),function(a){a.RE_EXN_ID===b("LSPlatformGraphQLTransport.bs").ServerError?b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_graphql_error"):a.RE_EXN_ID===b("Promise.bs").JsError?(b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_js_error"),b("recoverableViolation")("Encountered an JS error while publishing a LS sync request","messenger_web_product",{error:b("bs_caml_option").some(a._1)})):a.RE_EXN_ID===b("LSPlatformRealtimeTransport.bs").Timeout||a.RE_EXN_ID===b("LSPlatformRealtimeTransport.bs").NotConnected?b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_timeout_or_disc"):(b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_sync","send_sync_request_other_error"),b("recoverableViolation")("Encountered an error while publishing a LS sync request with non JS error error","messenger_web_product"));return i(c,g.sync_group_id).then(function(a){return e(g.sync_group_id)})});else{b("recoverableViolation")("Expected networkpayload for sync request but didn't get any","messenger_web_product");return b("Promise").resolve(void 0)}}if(!b("bs_caml").i64_eq(d,b("LSTaskWorkItemType.bs").workItemTypeDelayHandling))if(b("bs_caml").i64_eq(d,b("LSTaskWorkItemType.bs").workItemTypeNone)||!b("bs_caml").i64_eq(d,b("LSTaskWorkItemType.bs").workItemTypeHandleNative))return b("Promise").resolve(void 0);else{b("recoverableViolation")("Native handling for sync group not implemented yet","messenger_web_product");return b("Promise").resolve(void 0)}h=g.next_sync_ms;if(h!==void 0){f(g.sync_group_id,h);return b("Promise").resolve(void 0)}else{b("recoverableViolation")("Expected delay for delayed sync request but didn't get any","messenger_web_product");return b("Promise").resolve(void 0)}},m=function(c){return b("Promise").all(c[0].map(function(b){return l(a,b)}))},n=function(){b("promiseDone")(b("LSTransaction.bs").run(a,function(a){return b("LSBeginHandlingSync")(!1,b("LS.bs").make(a))},"readWrite").then(m),void 0,void 0)},o=function(){return b("SortedAsyncIterable.bs").subscribe(b("ReQL.bs").fromTableAscending(a.table("sync_groups")),function(a,b){return n()})},p=function(){return c.subscribeToNonTaskResponses(function(a,c){var e=c.ex;c=c.payload;e={experiments:e,syncScript:c};b("promiseDone")(b("gkx")("4463")?h.evalInOrderReceived(a,e):b("bs_curry")._1(d,e),function(a){return n()},function(a){b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_sync","handle_sync_response_failure"),a.RE_EXN_ID===b("Promise.bs").JsError?b("recoverableViolation")("Error encountered handling response from MQTT","messenger_web_product",{error:b("bs_caml_option").some(a._1)}):b("recoverableViolation")("Error encountered handling response from MQTT with unknown error","messenger_web_product")})})},q=function(a){var c=b("SortedAsyncIterable.bs").subscribe(b("ReQL.bs").fromTableAscending(a.table("sync_groups")),function(a,c){a=a.hd;var d=b("LSCookie.bs").get(void 0),e=d.c,f,g;if(typeof c==="number")f=1;else if(c.TAG===0){var h=c._0.currentCursor;h!==void 0?(g=h,f=2):f=1}else{h=c._0.currentCursor;h!==void 0?(g=h,f=2):f=1}switch(f){case 1:if(!b("bs_belt_Option").isSome(b("bs_js_dict").get(e,b("bs_int64").to_string(a))))return;b("bs_js_dict").unsafeDeleteKey(e,b("bs_int64").to_string(a));c=b("LSCookie.bs").writeCookie(d);b("promiseDone")(c,void 0,void 0);return;case 2:if(!b("bs_caml_obj").caml_notequal(b("bs_js_dict").get(e,b("bs_int64").to_string(a)),g))return;e[b("bs_int64").to_string(a)]=g;h=b("LSCookie.bs").writeCookie(d);b("promiseDone")(h,void 0,void 0);return}});return function(a){return b("bs_curry")._1(c,void 0)}},r=function(){return c.onReconnect(function(){b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_sync","resume_sync_reconnect"),b("LSLogHistory").log("LS Sync System reconnecting","debug"),b("promiseDone")(b("LSTransaction.bs").run(a,function(a){var c;return(c=b("ReQL.bs")).toArray(c.mergeJoin(c.fromTableAscending(a.table("sync_groups")),c.getKeyRange(c.fromTableAscending(a.table("network_requests")),{hd:"",tl:0}))).then(function(c){return b("Promise").all(c.map(function(c){var d=c[0];if(!(d.currentCursor!==void 0||b("bs_caml").i64_eq(d.syncStatus,b("bs_caml_int64").zero)))return window.Promise.resolve(void 0);d=c[1];return a.table("network_requests").put({taskQueueName:d.taskQueueName,syncDatabaseId:d.syncDatabaseId,epochId:void 0,networkTaskIdentifier:d.networkTaskIdentifier,lastSentTimestampMs:d.lastSentTimestampMs,failureCount:d.failureCount,lastSyncRequestTimestampMs:d.lastSyncRequestTimestampMs,lastDelayedRequestTimestampMs:d.lastDelayedRequestTimestampMs})}))}).then(function(c){return b("LSBeginHandlingSync")(!1,b("LS.bs").make(a))})},"readWrite").then(m),void 0,void 0)})},s=o(),t=p(),u=r(),v=!b("killswitch")("MESSENGER_WEB_PERSISTED_DB")&&b("gkx")("3174")&&b("LSPersistedDbGating").allTablesPersisted?q(a):function(a){};n();return{cleanup:function(){var a;(a=b("bs_curry"))._1(s,void 0);a._1(u,void 0);a._1(t,void 0);return a._1(v,void 0)}}}f.make=a}),null);
__d("LSPlatformTraceTasks",["LS.re","LSGenerateTraceId","LSPredefineTraceForTask","gkx","justknobx","regeneratorRuntime"],(function(a,b,c,d,e,f,g){"use strict";var h=new Set();c("gkx")("4729")&&h.add("207");function a(a,e){var f,g,i,j;return b("regeneratorRuntime").async(function(k){while(1)switch(k.prev=k.next){case 0:if(!c("justknobx")._("506")){k.next=12;break}f=0;case 2:if(!(f<e.length)){k.next=12;break}g=e[f];if(!((g.dataTraceId==null||g.dataTraceId==="")&&h.has(g.context))){k.next=9;break}i=c("LSGenerateTraceId")();if(!(i!=null)){k.next=9;break}k.next=9;return b("regeneratorRuntime").awrap(c("LSPredefineTraceForTask")(i,g.taskId,(j=g.context)!=null?j:"","",d("LS.re").make(a)));case 9:f++;k.next=2;break;case 12:case"end":return k.stop()}},null,this)}e={startTraceForTaskIfEligible:a};g["default"]=e}),98);
__d("LSPlatformTaskSystem.bs",["LS.bs","LSBeginHandlingPendingTasks","LSBeginHandlingPendingTasksForQueue","LSDict","LSHandleTaskSendFailureForQueue","LSHandleTaskSendSuccessForQueue","LSJson","LSPlatformDevtoolsHelpers.bs","LSPlatformRealtimeTransport.bs","LSPlatformRequestId","LSPlatformRequestScheduler","LSPlatformServerResponseHandler","LSPlatformTraceTasks","LSRequestType.bs","LSSyncChannel.bs","LSTaskWorkItemType.bs","LSTransaction.bs","MWPBumpEntityKey.bs","Promise","Promise.bs","ReQL.bs","SortedAsyncIterable.bs","bs_belt_Array","bs_belt_Option","bs_caml","bs_caml_int64","bs_caml_obj","bs_caml_option","bs_curry","bs_int64","gkx","promiseDone","recoverableViolation"],(function(a,b,c,d,e,f){"use strict";function a(a,c,d,e){var f=[],g=new(b("LSPlatformRequestScheduler"))(),h=function(c){c=b("bs_belt_Option").map(c.network_payload,function(a){return b("LSDict").shapeToRecord(a)});if(c!==void 0)return b("bs_belt_Option").mapWithDefault(b("bs_belt_Array").get(c.tasks,0),b("Promise").resolve(void 0),function(c){c=b("LSDict").shapeToRecord(c).task_id;return b("ReQL.bs").first(b("ReQL.bs").getKeyRange(b("ReQL.bs").fromTableAscending(a.table("pending_tasks")),{hd:c,tl:0})).then(function(a){return b("Promise").resolve(a!==void 0?a.dataTraceId:void 0)})});else return b("Promise").resolve(void 0)},i=function(c){return b("LSTransaction.bs").run(a,function(a){return b("LSHandleTaskSendFailureForQueue")(c,b("LS.bs").make(a))},"readWrite")},j=new(b("LSPlatformServerResponseHandler"))(d),k=function f(k){var l=function(c,d){g.schedule(function(){b("promiseDone")(b("LSTransaction.bs").run(a,function(a){return b("LSBeginHandlingPendingTasksForQueue")(c,!1,b("LS.bs").make(a))},"readWrite").then(function(a){return f(b("LSDict").shapeToRecord(a[0]))}),void 0,void 0)},c,b("bs_caml_int64").to_float(d))},m=b("LSPlatformRequestId").generate(),n=b("bs_belt_Option").map(k.network_payload,function(a){return b("LSDict").shapeToRecord(a)}),o=k.work_item_type;if(n!==void 0){if(b("bs_caml").i64_eq(o,b("LSTaskWorkItemType.bs").workItemTypeSendToServer)){var p=n.epoch_id,q=n.tasks,r=k.queue_name;b("LSPlatformDevtoolsHelpers.bs").recordTaskSending(q);return b("Promise.bs").$$catch(h(k).then(function(a){return b("bs_curry")._5(c.publish,b("LSSyncChannel.bs").mqtt,r,m,b("LSRequestType.bs").taskBatch,b("LSJson").stringify(b("LSDict").fromObject({version_id:e,tasks:q,epoch_id:p,data_trace_id:a})))}).then(function(c){if(c){var e=c._1,f=e.ex,g=e.payload;f={experiments:f,syncScript:g};return b("Promise.bs").$$catch((b("gkx")("4463")?j.evalWhenReady(c._0,f):b("bs_curry")._1(d,f)).then(function(c){b("LSPlatformDevtoolsHelpers.bs").recordTaskSent(q,e.payload);return b("LSTransaction.bs").run(a,function(a){return b("LSHandleTaskSendSuccessForQueue")(r,b("LS.bs").make(a))},"readWrite")}),function(a){b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_tasks","handle_task_failure");a.RE_EXN_ID===b("Promise.bs").JsError?b("recoverableViolation")("Encountered an error while processing a task response via realtime transport","messenger_web_product",{error:b("bs_caml_option").some(a._1)}):b("recoverableViolation")("Encountered an error while processing a task response via realtime transport","messenger_web_product",{error:a});return i(r)})}b("recoverableViolation")("Expected a response for a non fire forget task","messenger_web_product");return b("Promise").resolve(void 0)}),function(a){a.RE_EXN_ID===b("Promise.bs").JsError?(b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_timeout"),b("recoverableViolation")("Encountered an error while publishing a LS task payload via realtime transport","messenger_web_product",{error:b("bs_caml_option").some(a._1)})):a.RE_EXN_ID===b("LSPlatformRealtimeTransport.bs").Timeout||a.RE_EXN_ID===b("LSPlatformRealtimeTransport.bs").NotConnected||(b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_tasks","send_fail_generic"),b("recoverableViolation")("Encountered an error while publishing a LS task payload via realtime transport","messenger_web_product",{error:a}));return i(r)})}if(b("bs_caml").i64_eq(o,b("LSTaskWorkItemType.bs").workItemTypeSendToServerFireAndForget))return b("Promise.bs").$$catch(b("Promise").all(n.tasks.map(function(a){return b("LSDict").shapeToRecord(a)}).map(function(a){return b("bs_curry")._5(c.publish,b("LSSyncChannel.bs").mqtt,void 0,m,b("LSRequestType.bs").fireForget,b("LSJson").stringify(b("LSDict").fromObject({label:a.label,payload:a.payload,version:e})))})).then(function(a){return b("Promise").resolve(void 0)}),function(a){return b("Promise").resolve(void 0)})}if(b("bs_caml").i64_eq(o,b("LSTaskWorkItemType.bs").workItemTypeDelayHandling)){l(k.queue_name,k.next_sync_ms);return b("Promise").resolve(void 0)}else if(b("bs_caml").i64_eq(o,b("LSTaskWorkItemType.bs").workItemTypeNone))return b("Promise").resolve(void 0);else if(b("bs_caml").i64_eq(o,b("LSTaskWorkItemType.bs").workItemTypeHandleNative)){b("recoverableViolation")("Native tasks not supported so far","messenger_web_product");return b("Promise").resolve(void 0)}else{b("recoverableViolation")("Unknown Task type of "+b("bs_int64").to_string(o),"messenger_web_product");return b("Promise").resolve(void 0)}},l=function(c){b("promiseDone")(b("LSTransaction.bs").run(a,function(a){return(c.length>0?b("Promise.bs").$$catch(b("LSPlatformTraceTasks").startTraceForTaskIfEligible(a,c),function(a){return b("Promise").resolve(void 0)}):b("Promise").resolve(void 0)).then(function(c){return b("LSBeginHandlingPendingTasks")(!1,b("LS.bs").make(a))})},"readWrite").then(function(a){return b("Promise").all(a[0].map(function(a){return b("LSDict").shapeToRecord(a)}).map(k))}),void 0,void 0)},m=function(){var c,d={contents:!1},e={contents:[]},g=b("SortedAsyncIterable.bs").subscribe((c=b("ReQL.bs")).fromTableAscending(a.table("pending_tasks")),function(a,c){d.contents=!0;if(typeof c==="number")return;if(c.TAG===0)a=c._0;else{c=c._0;if(b("bs_caml").i64_gt(c.failureCount,b("bs_caml_int64").one))return b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_tasks","tasks_failure_count_gt_one");a=c}if(a.dataTraceId===void 0||b("bs_caml_obj").caml_equal(a.dataTraceId,"")){e.contents.push(a);return}}),h=b("SortedAsyncIterable.bs").subscribe(c.fromTableAscending(a.table("pending_fire_and_forget_tasks")),function(a,b){return l(f)}),i=b("SortedAsyncIterable.bs").subscribe(c.filter(c.fromTableAscending(a.table("network_requests")),function(a){return a.taskQueueName!==""}),function(a,c){if(typeof c==="number"){d.contents=!0;return}else if(c.TAG===0||!b("bs_caml").i64_gt(c._0.failureCount,b("bs_caml_int64").one))return;else return b("MWPBumpEntityKey.bs").bumpEntityKeyWithAppId("lsplatform_tasks","network_failure_count_gt_one")}),j=a.subscribeToCommit(function(a){if(!d.contents)return;a=e.contents;e.contents=[];d.contents=!1;return l(a)});return function(){var a;(a=b("bs_curry"))._1(g,void 0);a._1(h,void 0);a._1(i,void 0);return a._1(j,void 0)}},n=function(){return c.onReconnect(function(){b("promiseDone")(b("LSTransaction.bs").run(a,function(a){return b("ReQL.bs").toArray(b("ReQL.bs").bounds(b("ReQL.bs").fromTableAscending(a.table("network_requests")),{NAME:"greaterThan",VAL:{hd:"",tl:0}})).then(function(c){return b("Promise").all(c.map(function(c){return b("LSHandleTaskSendFailureForQueue")(c.taskQueueName,b("LS.bs").make(a))}))})},"readWrite"),void 0,void 0)})},o=m(),p=n();l(f);return{cleanup:function(){o();return b("bs_curry")._1(p,void 0)}}}f.make=a}),null);
__d("LSPlatformClient.bs",["ExecutionEnvironment","LSClearEpochBeforeResumeSync.bs","LSDataTraceFlushDeferred.bs","LSJSInMemoryStorage.bs","LSMetadata","LSPlatformDevtoolsHelpers.bs","LSPlatformHardcodedInitSync.bs","LSPlatformRealtimeTransport.bs","LSPlatformSyncSystem.bs","LSPlatformTaskSystem.bs","Promise","bs_curry","cr:1575","cr:3238"],(function(a,b,c,d,e,f){"use strict";function a(a){var c={contents:0};if(b("ExecutionEnvironment").canUseDOM)return a.getDb().then(function(d){return b("bs_curry")._1(a.getEval,void 0).then(function(e){b("LSPlatformDevtoolsHelpers.bs").registerDb(d);var f=b("bs_curry")._2(b("LSPlatformDevtoolsHelpers.bs").evalWithDevtoolSupport(e),void 0,d);return b("LSClearEpochBeforeResumeSync.bs").call(d).then(function(c){if(a.sendHardcodedInitSync)return b("LSPlatformHardcodedInitSync.bs").sendHardcodedInitSync(a,f,d);else return b("Promise").resolve(void 0)}).then(function(e){e=function(e){e=c.contents;if(typeof e!=="number")return b("Promise").resolve(void 0);e=c.contents===1?b("LSClearEpochBeforeResumeSync.bs").call(d):b("Promise").resolve(void 0);return e.then(function(e){var g=b("LSPlatformRealtimeTransport.bs").make(a.realtimeUnderylingTransport,a.appId),h=b("LSPlatformTaskSystem.bs").make(d,g,f,a.schemaVersion),i=b("LSPlatformSyncSystem.bs").make(d,g,f,a.schemaVersion,a.deviceId,a.executeGraphQLLightSpeedRequest);e=function(a){h.cleanup(),i.cleanup(),g.cleanup(),c.contents=1};c.contents={_0:e,_1:g.onConnectionStatusChange}})};return b("Promise").resolve({start:e,cleanup:function(a){a=c.contents;if(typeof a==="number")return;else return b("bs_curry")._1(a._0,void 0)},db:d,onConnectionStatusChange:function(a){var b=c.contents;if(typeof b==="number")return function(a){};else return b._1(a)}})})})}).then(function(a){b("LSDataTraceFlushDeferred.bs").watchForExpiredTraces(a.db);!(b("cr:3238")==null)&&!(b("cr:1575")==null)&&b("bs_curry")._1(b("cr:1575").listenForChangesToBackupState,a.db);return a});else return b("Promise").resolve({start:function(a){return b("Promise").resolve(void 0)},cleanup:function(a){},db:b("LSJSInMemoryStorage.bs").make(b("LSMetadata").metadata),onConnectionStatusChange:function(a){return function(a){}}})}f.$MWEncryptedBackupsListenForChangesToBackupStateInitPath$requireCond=b("cr:1575");f.$MWEncryptedBackupsListenForChangesToBackupStateInitPath$requireCond$1=b("cr:3238");f.make=a}),null);
__d("BaseSubscriptionTypeahead.react",["CometHeroInteractionContextPassthrough.react","CometInternalTypeahead.react","CometInternalTypeaheadStateProvider","CometInternalTypeaheadSubscriptionProvider","emptyFunction","react","useCometUniqueID","withCometTypeaheadInputStrategyShouldQueryStringFollowHighlightedEntry"],(function(a,b,c,d,e,f,g){"use strict";var h=d("react");b=d("react");var i=b.useCallback,j=b.useMemo;function a(a){var b=a.autoFocus;b=b===void 0?!1:b;var d=a.isDisabled;d=d===void 0?!1:d;var e=a.errorMessage;e=e===void 0?null:e;var f=a.inputStrategyRenderer,g=a.dataSource,k=a.dataSourceFetchConfigParams,l=a.decorators,m=l===void 0?[]:l;l=a.emptyEntries_DO_NOT_USE;var n=a.id,o=a.label;o=o===void 0?"":o;var p=a.loggingContext,q=a.onBackspace;q=q===void 0?c("emptyFunction"):q;var r=a.onBlur;r=r===void 0?c("emptyFunction"):r;var s=a.onChange,t=a.onClose,u=a.onEnter;u=u===void 0?c("emptyFunction"):u;var v=a.onEscape;v=v===void 0?c("emptyFunction"):v;var w=a.onFetchEntries_DO_NOT_USE,x=a.onFocus;x=x===void 0?c("emptyFunction"):x;var y=a.onOpen,z=a.onPressEntry,A=a.placeholder;A=A===void 0?"":A;var B=a.shouldQueryStringFollowHighlightedEntry,C=B===void 0?!0:B;B=a.shouldQueryStringUpdateFromSelectedEntryOnClick;var D=B===void 0?!0:B;B=a.testid;B=B===void 0?"":B;B=a.traceProvider;var E=a.inputRef,F=a.viewRole;F=F===void 0?"listbox":F;var G=a.viewStrategyRenderer;a=babelHelpers.objectWithoutPropertiesLoose(a,["autoFocus","isDisabled","errorMessage","inputStrategyRenderer","dataSource","dataSourceFetchConfigParams","decorators","emptyEntries_DO_NOT_USE","id","label","loggingContext","onBackspace","onBlur","onChange","onClose","onEnter","onEscape","onFetchEntries_DO_NOT_USE","onFocus","onOpen","onPressEntry","placeholder","shouldQueryStringFollowHighlightedEntry","shouldQueryStringUpdateFromSelectedEntryOnClick","testid","traceProvider","inputRef","viewRole","viewStrategyRenderer"]);var H=c("useCometUniqueID")(),I=j(function(){var a=c("CometInternalTypeahead.react");m.forEach(function(b){var c=b.decorate;b=b.params;a=c(a,b)});return a},[m]),J=i(function(a){D&&s(a.label),z&&z(a)},[s,z,D]),K=j(function(){return c("withCometTypeaheadInputStrategyShouldQueryStringFollowHighlightedEntry")(f,{shouldQueryStringFollowHighlightedEntry:C})},[f,C]);o=o||A;return h.jsx(c("CometHeroInteractionContextPassthrough.react"),{clear:!0,children:h.jsx(c("CometInternalTypeaheadStateProvider"),{emptyEntries_DO_NOT_USE:l,onClose:t,onOpen:y,children:h.jsx(c("CometInternalTypeaheadSubscriptionProvider"),{dataSource:g,dataSourceFetchConfigParams:k,loggingContext:p,onFetchEntries_DO_NOT_USE:w,traceProvider:B,children:h.jsx(I,babelHelpers["extends"]({},a,{autoFocus:b,errorMessage:e,id:(l=n)!=null?l:H,inputRef:E,inputStrategyRenderer:K,isDisabled:d,label:o,onBackspace:q,onBlur:r,onChange:s,onDownArrow:c("emptyFunction"),onEnter:u,onEscape:v,onFocus:x,onHighlightEntry:c("emptyFunction"),onPressEntry:J,onShiftTab:c("emptyFunction"),onTab:c("emptyFunction"),onUpArrow:c("emptyFunction"),placeholder:A,testid:void 0,viewRole:F,viewStrategyRenderer:G}))})})})}a.displayName=a.name+" [from "+f.id+"]";g["default"]=a}),98);
__d("LsUniversalSearchQueryChangedFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f){"use strict";a=b("getFalcoLogPolicy_DO_NOT_USE")("94");c=b("FalcoLoggerInternal").create("ls_universal_search_query_changed",a);e.exports=c}),null);
__d("LsUniversalSearchStartFalcoEvent",["FalcoLoggerInternal","getFalcoLogPolicy_DO_NOT_USE"],(function(a,b,c,d,e,f){"use strict";a=b("getFalcoLogPolicy_DO_NOT_USE")("96");c=b("FalcoLoggerInternal").create("ls_universal_search_start",a);e.exports=c}),null);